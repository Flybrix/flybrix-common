!function(){"use strict";angular.module("flybrixCommon",[])}(),function(){"use strict";function e(){this.index=0}function n(){return 0}function t(e){var n=l["Uint"+e];if(void 0===n)throw new Error("Unsupported split bit count: "+e+". Allowed counts: 8, 16, 32, 64");return n}function r(e){function n(n,t,r){c.encode(n,t,a(r,e))}function t(n,t){return i(c.decode(n,t),e)}function r(){return""}function u(){return e}var c=o(e,l.Uint8);return new f(u,n,t,r)}function a(e,n){var t=new Uint8Array(n);return e.split("").forEach(function(e,n){t[n]=e.charCodeAt(0)}),t[n-1]=0,t}function i(e,n){for(var t="",r=Math.min(e.length,n-1),a=0;a<r;++a){if(0===e[a])return t;t+=String.fromCharCode(e[a])}return t}function o(e,n,r){function a(t,r,a){for(var i=0;i<e;++i)n.encode(t,r,a[i])}function i(t,r){for(var a=[],i=0;i<e;++i)a.push(n.decode(t,r));return a}function o(){for(var t=[],r=0;r<e;++r)t.push(n.empty());return t}function u(t,r,a,i){var o=i.pop();T.encode(t,r,o);for(var u=0;u<e;++u)o&1<<u&&n.encodePartial(t,r,a[u],i)}function c(t,r,a){for(var i=T.decode(t,r),o=[],u=0;u<e;++u)i&1<<u?o.push(n.decodePartial(t,r,a[u])):o.push(a[u]);return o}function l(t){var a,i=!0;void 0!==t&&(a=t.pop(),i=!1);for(var o=i?0:r/8,u=0;u<e;++u)(i||a&1<<u)&&(o+=n.bytecount(t));return o}function s(t,r,a,i){for(var o=0;o<e;++o)n.encodePartial(t,r,a[o],i)}function d(t,r,a){for(var i=[],o=0;o<e;++o)i.push(n.decodePartial(t,r,a[o]));return i}function _(t){for(var r=0,a=0;a<e;++a)r+=n.bytecount(t);return r}if(void 0===e)throw new Error("Array type requires length");if(!(n instanceof f))throw new Error("Array type requires Handler type as element");var m;if(void 0!==r){var T=t(r);m=new f(l,a,i,o,u,c)}else m=new f(_,a,i,o,s,d);return m.children={element:n,count:e},m}function u(e,n){function r(n,t,r){e.forEach(function(e,a){e.encode(n,t,r[a])})}function a(n,t){var r=[];return e.forEach(function(e,a){r.push(e.decode(n,t))}),r}function i(){var n=[];return e.forEach(function(e){n.push(e.empty())}),n}function o(n,t,r,a){var i=a.pop();m.encode(n,t,i),e.forEach(function(e,o){i&1<<o&&e.encodePartial(n,t,r[o],a)})}function u(n,t,r){var a=m.decode(n,t),i=[];return e.forEach(function(e,o){a&1<<o?i.push(e.decodePartial(n,t,r[o])):i.push(r[o])}),i}function c(t){var r,a=!0;return void 0!==t&&(r=t.pop(),a=!1),e.reduce(function(e,n,i){return a||r&1<<i?e+n.bytecount(t):e},a?0:n/8)}function l(n,t,r,a){e.forEach(function(e,i){e.encodePartial(n,t,r[i],a)})}function s(n,t,r){var a=[];return e.forEach(function(e,i){a.push(e.decodePartial(n,t,r[i]))}),a}function d(n){return e.reduce(function(e,t){return e+t.bytecount(n)},0)}if(void 0===e.length)throw new Error("Polyarray type requires an array of Handler objects");e.forEach(function(e){if(!(e instanceof f))throw new Error("Polyarray type requires an array of Handler objects")});var _;e.reduce(function(e,n){return e+n.bytecount},0);if(void 0!==n){var m=t(n);_=new f(c,r,a,i,o,u)}else _=new f(d,r,a,i,l,s);return _.children=e,_}function c(e,n){function r(n,t,r){e.forEach(function(e){e.element.encode(n,t,r[e.key])})}function a(n,t){var r={};return e.forEach(function(e){r[e.key]=e.element.decode(n,t)}),r}function i(){var n={};return e.forEach(function(e){n[e.key]=e.element.empty()}),n}function o(n,t,r,a){var i=a.pop();m.encode(n,t,i),e.forEach(function(e){i&1<<e.part&&e.element.encodePartial(n,t,r[e.key],a)})}function u(n,t,r){var a=m.decode(n,t),i={};return e.forEach(function(e){a&1<<e.part?i[e.key]=e.element.decodePartial(n,t,r[e.key]):i[e.key]=r[e.key]}),i}function c(t){var r,a=!0;return void 0!==t&&(r=t.pop(),a=!1),e.reduce(function(e,n){return a||r&1<<n.part?e+n.element.bytecount(t):e},a?0:n/8)}function l(n,t,r,a){e.forEach(function(e){e.element.encodePartial(n,t,r[e.key],a)})}function s(n,t,r){var a={};return e.forEach(function(e){a[e.key]=e.element.decodePartial(n,t,r[e.key])}),a}function d(n){return e.reduce(function(e,t){return e+t.element.bytecount(n)},0)}if(void 0===e.length)throw new Error("Map type requires an array of {key: String, element: Handler} maps");e.forEach(function(e){if(void 0===e.key||!(e.element instanceof f))throw new Error("Map type requires an array of {key: String, element: Handler} maps")}),void 0!==n&&e.forEach(function(e){if(void 0===e.part)throw new Error("Map type requires an array of {key: String, element: Handler, part: Number} maps when split bits are defined")});var _;if(void 0!==n){var m=t(n);_=new f(c,r,a,i,o,u)}else _=new f(d,r,a,i,l,s);return _.children=e,_}function f(e,n,t,r,a,i){a=a||n,i=i||t,this.bytecount=e,this.encode=n,this.decode=t,this.encodePartial=a,this.decodePartial=i,this.empty=r}angular.module("flybrixCommon").factory("encodable",function(){return l});var l={string:r,map:c,array:o,polyarray:u,Serializer:e};e.prototype.add=function(e){this.index+=e},["Uint","Int"].forEach(function(e){[1,2,4].forEach(function(t){function r(e,n,r){e["set"+o](n.index,r,1),n.add(t)}function a(e,n){var r=e["get"+o](n.index,1);return n.add(t),r}function i(){return t}var o=e+8*t;l[o]=new f(i,r,a,n)})}),[4,8].forEach(function(e){function t(n,t,r){n["set"+i](t.index,r,1),t.add(e)}function r(n,t){var r=n["get"+i](t.index,1);return t.add(e),r}function a(){return e}var i="Float"+8*e;l[i]=new f(a,t,r,n)}),l.bool=new f(function(){return 1},function(e,n,t){l.Uint8.encode(e,n,t?1:0)},function(e,n){return 0!==l.Uint8.decode(e,n)},function(){return!1})}(),function(){"use strict";function e(e){var n={},t=e,r=t.map([{key:"red",element:t.Uint8},{key:"green",element:t.Uint8},{key:"blue",element:t.Uint8}]),a=t.map([{key:"status",element:t.Uint16},{key:"pattern",element:t.Uint8},{key:"colors",element:t.map([{key:"right_front",element:r},{key:"right_back",element:r},{key:"left_front",element:r},{key:"left_back",element:r}])},{key:"indicator_red",element:t.bool},{key:"indicator_green",element:t.bool}]),i=t.array(3,t.Float32),o=(t.array(3,t.Uint8),t.array(6,t.Uint8)),u=t.array(6,t.Uint16),c=t.array(7,t.Float32),f=t.array(2,t.Float32),l=t.array(16,a,16),s=(t.string(9),[{part:0,key:"version",element:t.array(3,t.Uint8)},{part:1,key:"id",element:t.Uint32},{part:2,key:"pcbOrientation",element:i},{part:2,key:"pcbTranslation",element:i},{part:3,key:"mixTableFz",element:t.array(8,t.Int8)},{part:3,key:"mixTableTx",element:t.array(8,t.Int8)},{part:3,key:"mixTableTy",element:t.array(8,t.Int8)},{part:3,key:"mixTableTz",element:t.array(8,t.Int8)},{part:4,key:"magBias",element:i},{part:5,key:"assignedChannel",element:o},{part:5,key:"commandInversion",element:t.Uint8},{part:5,key:"channelMidpoint",element:u},{part:5,key:"channelDeadzone",element:u},{part:6,key:"thrustMasterPIDParameters",element:c},{part:6,key:"pitchMasterPIDParameters",element:c},{part:6,key:"rollMasterPIDParameters",element:c},{part:6,key:"yawMasterPIDParameters",element:c},{part:6,key:"thrustSlavePIDParameters",element:c},{part:6,key:"pitchSlavePIDParameters",element:c},{part:6,key:"rollSlavePIDParameters",element:c},{part:6,key:"yawSlavePIDParameters",element:c},{part:6,key:"pidBypass",element:t.Uint8},{part:7,key:"stateEstimationParameters",element:f},{part:7,key:"enableParameters",element:f},{part:8,key:"ledStates",element:l},{part:9,key:"name",element:t.string(9)}]);n["1.4.0"]=t.map(s.slice(),16);var d=[{part:6,key:"thrustGain",element:t.Float32},{part:6,key:"pitchGain",element:t.Float32},{part:6,key:"rollGain",element:t.Float32},{part:6,key:"yawGain",element:t.Float32}];s=s.slice(0,21).concat(d,s.slice(21)),n["1.5.0"]=t.map(s.slice(),16);var _=[{part:10,key:"forwardMasterPIDParameters",element:c},{part:10,key:"rightMasterPIDParameters",element:c},{part:10,key:"upMasterPIDParameters",element:c},{part:10,key:"forwardSlavePIDParameters",element:c},{part:10,key:"rightSlavePIDParameters",element:c},{part:10,key:"upSlavePIDParameters",element:c},{part:10,key:"velocityPidBypass",element:t.Uint8},{part:11,key:"inertialBiasAccel",element:i},{part:11,key:"inertialBiasGyro",element:i}];return s=s.concat(_),n["1.6.0"]=t.map(s.slice(),16),n}angular.module("flybrixCommon").factory("configHandler",e),e.$inject=["encodable"]}(),function(){"use strict";function e(e){var n=[0,0,0],t="0.0.0",r={"1.4.0":!0,"1.5.0":!0,"1.6.0":!0},a=[1,6,0],i=e["1.6.0"],o=i,u={"1.4.0":134217727,"1.5.0":134217727,"1.6.0":134217727},c=4294967295;return{set:function(r){n=r,t=r.join("."),o=e[t]||i,c=u[t]||4294967295},get:function(){return n},key:function(){return t},supported:function(){return!0===r[t]},desired:function(){return a},desiredKey:function(){return"1.6.0"},configHandler:function(){return o},stateMask:function(){return c}}}angular.module("flybrixCommon").factory("firmwareVersion",e),e.$inject=["configHandler"]}(),function(){"use strict";function e(e,n){function t(){return e("Calibrating magnetometer bias"),n.send(n.field.COM_SET_CALIBRATION,[1,0],!1)}function r(t,r){return e("Calibrating gravity for pose: "+t),n.send(n.field.COM_SET_CALIBRATION,[1,r+1],!1)}function a(){return e("Finishing calibration"),n.send(n.field.COM_SET_CALIBRATION,[0,0],!1)}return{magnetometer:t,accelerometer:{flat:r.bind(null,"flat",0),forward:r.bind(null,"lean forward",1),back:r.bind(null,"lean back",2),right:r.bind(null,"lean right",3),left:r.bind(null,"lean left",4)},finish:a}}angular.module("flybrixCommon").factory("calibration",e),e.$inject=["commandLog","serial"]}(),function(){"use strict";function e(){return{Reader:n,encode:r}}function n(e){void 0===e&&(e=2e3),this.N=e,this.buffer=new Uint8Array(e),this.ready_for_new_message=!0,this.buffer_length=0}function t(e){for(var n=0,t=0,r=0,a=!1;e.buffer[n];)r?(--r,e.buffer[t++]=e.buffer[n++]):(a&&(e.buffer[t++]=0),r=e.buffer[n++]-1,a=r<254);return r?0:t}function r(e){for(var n=new Uint8Array(Math.floor((255*e.byteLength+761)/254)),t=1,r=0,a=0;a<e.length;++a){254==n[r]&&(n[r]=255,r=t++,n[r]=0);var i=e[a];++n[r],i?n[t++]=i:(r=t++,n[r]=0)}return n.subarray(0,t).slice().buffer}angular.module("flybrixCommon").factory("cobs",e),n.prototype.AppendToBuffer=function(e,n,r){for(var a=0;a<e.length;a++){var i=e[a];if(this.ready_for_new_message&&(this.ready_for_new_message=!1,this.buffer_length=0),this.buffer[this.buffer_length++]=i,i&&this.buffer_length==this.N)r("overflow","buffer overflow in COBS decoding"),this.ready_for_new_message=!0;else if(!i){this.buffer_length=t(this);var o=0===this.buffer_length;o&&(this.buffer[0]=1);for(var u=1;u<this.buffer_length;++u)this.buffer[0]^=this.buffer[u];if(0===this.buffer[0])if(this.ready_for_new_message=!0,this.buffer_length>5){for(var c=this.buffer[1],f=0,l=0;l<4;++l)f|=this.buffer[l+2]<<8*l;n(c,f,this.buffer.subarray(6,this.buffer_length).slice().buffer)}else r("short","Too short packet");else{this.ready_for_new_message=!0;for(var s="",d="",u=0;u<this.buffer_length;u++)s+=this.buffer[u]+",",d+=String.fromCharCode(this.buffer[u]);if(o)r("frame","Unexpected ending of packet");else{var _="BAD CHECKSUM ("+this.buffer_length+" bytes)"+s+d;r("checksum",_)}}}}}}(),function(){"use strict";function e(e){function n(e){void 0!==e&&(i.push(e),o.notify(t()))}function t(){return i}function r(){o=e.defer()}function a(e){return o.promise.then(void 0,void 0,e)}var i=[],o=e.defer(),u=n;return u.log=n,u.clearSubscribers=r,u.onMessage=a,u.read=t,u}angular.module("flybrixCommon").factory("commandLog",e),e.$inject=["$q"]}(),function(){"use strict";function e(e,n,t){function r(e,n,t,r,i,u,c,f){a(e,n,t,function(){o(n,t,r)},i,u,c,f)}function a(e,n,t,r,a,o,c,f){switch(e){case u.State:r(n,t);break;case u.Command:a(n,t);break;case u.DebugString:var l=i(t);o(l);break;case u.HistoryData:var l=i(t);c(l);break;case u.Response:f(n,new DataView(t,0).getInt32(0,1))}}function i(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function o(e,r,a){var i=d.empty(),o=[],u=new DataView(r,0),c=new n.Serializer,l=0;e&=t.stateMask(),d.children.forEach(function(n,t){if(e&1<<t){o[t]=!0;var r=n.element,a=n.key;i[a]=r.decode(u,c)}}),e&f.STATE_MICROS&&(l=1e6/(i.timestamp_us-s),s=i.timestamp_us),e&f.STATE_TEMPERATURE&&(i.temperature/=100),e&f.STATE_PRESSURE&&(i.pressure/=256),a(i,o,l)}var u={State:0,Command:1,DebugString:3,HistoryData:4,Response:255},c={COM_REQ_RESPONSE:1,COM_SET_EEPROM_DATA:2,COM_REINIT_EEPROM_DATA:4,COM_REQ_EEPROM_DATA:8,COM_REQ_ENABLE_ITERATION:16,COM_MOTOR_OVERRIDE_SPEED_0:32,COM_MOTOR_OVERRIDE_SPEED_1:64,COM_MOTOR_OVERRIDE_SPEED_2:128,COM_MOTOR_OVERRIDE_SPEED_3:256,COM_MOTOR_OVERRIDE_SPEED_4:512,COM_MOTOR_OVERRIDE_SPEED_5:1024,COM_MOTOR_OVERRIDE_SPEED_6:2048,COM_MOTOR_OVERRIDE_SPEED_7:4096,COM_MOTOR_OVERRIDE_SPEED_ALL:8160,COM_SET_COMMAND_OVERRIDE:8192,COM_SET_STATE_MASK:16384,COM_SET_STATE_DELAY:32768,COM_SET_SD_WRITE_DELAY:65536,COM_SET_LED:1<<17,COM_SET_SERIAL_RC:1<<18,COM_SET_CARD_RECORDING:1<<19,COM_SET_PARTIAL_EEPROM_DATA:1<<20,COM_REINIT_PARTIAL_EEPROM_DATA:1<<21,COM_REQ_PARTIAL_EEPROM_DATA:1<<22,COM_REQ_CARD_RECORDING_STATE:1<<23,COM_SET_PARTIAL_TEMPORARY_CONFIG:1<<24,COM_SET_COMMAND_SOURCES:1<<25,COM_SET_CALIBRATION:1<<26},f={STATE_ALL:4294967295,STATE_NONE:0,STATE_MICROS:1,STATE_STATUS:2,STATE_V0:4,STATE_I0:8,STATE_I1:16,STATE_ACCEL:32,STATE_GYRO:64,STATE_MAG:128,STATE_TEMPERATURE:256,STATE_PRESSURE:512,STATE_RX_PPM:1024,STATE_AUX_CHAN_MASK:2048,STATE_COMMANDS:4096,STATE_F_AND_T:8192,STATE_PID_FZ_MASTER:16384,STATE_PID_TX_MASTER:32768,STATE_PID_TY_MASTER:65536,STATE_PID_TZ_MASTER:1<<17,STATE_PID_FZ_SLAVE:1<<18,STATE_PID_TX_SLAVE:1<<19,STATE_PID_TY_SLAVE:1<<20,STATE_PID_TZ_SLAVE:1<<21,STATE_MOTOR_OUT:1<<22,STATE_KINE_ANGLE:1<<23,STATE_KINE_RATE:1<<24,STATE_KINE_ALTITUDE:1<<25,STATE_LOOP_COUNT:1<<26},l={STATUS_BOOT:1,STATUS_MPU_FAIL:2,STATUS_BMP_FAIL:4,STATUS_RX_FAIL:8,STATUS_IDLE:16,STATUS_ENABLING:32,STATUS_CLEAR_MPU_BIAS:64,STATUS_SET_MPU_BIAS:128,STATUS_FAIL_STABILITY:256,STATUS_FAIL_ANGLE:512,STATUS_FAIL_OTHER:16384,STATUS_ENABLED:1024,STATUS_BATTERY_LOW:2048,STATUS_TEMP_WARNING:4096,STATUS_LOG_FULL:8192,STATUS_OVERRIDE:32768},s=0,d=function(){var e=n,t=e.polyarray([e.Uint32,e.Float32,e.Float32,e.Float32,e.Float32,e.Float32]);return e.map([{key:"timestamp_us",element:e.Uint32},{key:"status",element:e.Uint16},{key:"V0_raw",element:e.Uint16},{key:"I0_raw",element:e.Uint16},{key:"I1_raw",element:e.Uint16},{key:"accel",element:e.array(3,e.Float32)},{key:"gyro",element:e.array(3,e.Float32)},{key:"mag",element:e.array(3,e.Float32)},{key:"temperature",element:e.Uint16},{key:"pressure",element:e.Uint32},{key:"ppm",element:e.array(6,e.Int16)},{key:"AUX_chan_mask",element:e.Uint8},{key:"command",element:e.array(4,e.Int16)},{key:"control",element:e.array(4,e.Float32)},{key:"pid_master_Fz",element:t},{key:"pid_master_Tx",element:t},{key:"pid_master_Ty",element:t},{key:"pid_master_Tz",element:t},{key:"pid_slave_Fz",element:t},{key:"pid_slave_Tx",element:t},{key:"pid_slave_Ty",element:t},{key:"pid_slave_Tz",element:t},{key:"MotorOut",element:e.array(8,e.Int16)},{key:"kinematicsAngle",element:e.array(3,e.Float32)},{key:"kinematicsRate",element:e.array(3,e.Float32)},{key:"kinematicsAltitude",element:e.Float32},{key:"loopCount",element:e.Uint32}])}();return{processBinaryDatastream:r,MessageType:u,CommandFields:c,StatusCodes:l,StateFields:f}}angular.module("flybrixCommon").factory("parser",e),e.$inject=["commandLog","encodable","firmwareVersion"]}(),function(){"use strict";function e(e,n){function t(e){return{red:e>>16&255,green:e>>8&255,blue:255&e}}function r(e,n,r,a,i,o){return void 0===a&&(a=r),r=t(r),a=t(a),i=i||!1,o=o||!1,{status:e,pattern:n,colors:{right_front:r,right_back:r,left_front:a,left_back:a},indicator_red:i,indicator_green:o}}function a(e){var n=e>>16&255,t=e>>8&255,r=255&e;return n*=.9,t*=.9,r*=.9,Math.floor(n)<<16|Math.floor(t)<<8|Math.floor(r)}function i(n){(n=Math.floor(n))>=0&&n<3||(n=0);var t=e.configHandler(),r={};switch(angular.copy(f),t.children.forEach(function(e){var n=e.key;r[n]=angular.copy(f[n])}),r.id=n,r.version=e.get().slice(),n){case 0:r.mixTableFz=[1,1,0,0,0,0,1,1],r.mixTableTx=[1,1,0,0,0,0,-1,-1],r.mixTableTy=[-1,1,0,0,0,0,-1,1],r.mixTableTz=[1,-1,0,0,0,0,-1,1];break;case 1:r.mixTableFz=[1,1,1,1,0,0,1,1],r.mixTableTx=[1,1,0,0,0,0,-1,-1],r.mixTableTy=[-1,1,-1,1,0,0,-1,1],r.mixTableTz=[1,-1,-1,1,0,0,1,-1];break;case 2:r.mixTableFz=[1,1,1,1,1,1,1,1],r.mixTableTx=[1,1,1,1,-1,-1,-1,-1],r.mixTableTy=[-1,1,-1,1,-1,1,-1,1],r.mixTableTz=[1,-1,-1,1,1,-1,-1,1]}return r}var o={NO_OVERRIDE:0,FLASH:1,BEACON:2,BREATHE:3,ALTERNATE:4,SOLID:5},u={Black:0,Red:16711680,Green:32768,Orange:16753920,Blue:255},c=[r(n.StatusCodes.STATUS_MPU_FAIL,o.SOLID,a(u.Black),a(u.Red),!0),r(n.StatusCodes.STATUS_BMP_FAIL,o.SOLID,a(u.Red),a(u.Black),!0),r(n.StatusCodes.STATUS_BOOT,o.SOLID,a(u.Green)),r(n.StatusCodes.STATUS_RX_FAIL,o.FLASH,a(u.Orange)),r(n.StatusCodes.STATUS_FAIL_OTHER,o.ALTERNATE,a(u.Blue)),r(n.StatusCodes.STATUS_FAIL_STABILITY,o.FLASH,a(u.Black),a(u.Blue)),r(n.StatusCodes.STATUS_FAIL_ANGLE,o.FLASH,a(u.Blue),a(u.Black)),r(n.StatusCodes.STATUS_OVERRIDE,o.BEACON,a(u.Red)),r(n.StatusCodes.STATUS_TEMP_WARNING,o.FLASH,a(u.Red)),r(n.StatusCodes.STATUS_BATTERY_LOW,o.BEACON,a(u.Orange)),r(n.StatusCodes.STATUS_ENABLING,o.FLASH,a(u.Blue)),r(n.StatusCodes.STATUS_ENABLED,o.BEACON,a(u.Blue)),r(n.StatusCodes.STATUS_IDLE,o.BEACON,a(u.Green)),r(0,0,0),r(0,0,0),r(0,0,0)],f={pcbOrientation:[0,0,0],pcbTranslation:[0,0,0],magBias:[0,0,0],assignedChannel:[2,1,0,3,4,5],commandInversion:6,channelMidpoint:[1515,1515,1500,1520,1500,1500],channelDeadzone:[20,20,20,40,20,20],thrustMasterPIDParameters:[1,0,0,0,.005,.005,1],pitchMasterPIDParameters:[10,1,0,10,.005,.005,10],rollMasterPIDParameters:[10,1,0,10,.005,.005,10],yawMasterPIDParameters:[5,1,0,10,.005,.005,180],thrustSlavePIDParameters:[1,0,0,10,.001,.001,.3],pitchSlavePIDParameters:[10,4,0,30,.001,.001,30],rollSlavePIDParameters:[10,4,0,30,.001,.001,30],yawSlavePIDParameters:[30,5,0,20,.001,.001,240],thrustGain:4095,pitchGain:2047,rollGain:2047,yawGain:2047,pidBypass:25,stateEstimationParameters:[1,.01],enableParameters:[.001,30],ledStates:c,name:"FLYBRIX",forwardMasterPIDParameters:[10,1,0,10,.005,.005,10],rightMasterPIDParameters:[10,1,0,10,.005,.005,10],upMasterPIDParameters:[10,1,0,10,.005,.005,10],forwardSlavePIDParameters:[10,4,0,30,.001,.001,30],rightSlavePIDParameters:[10,4,0,30,.001,.001,30],upSlavePIDParameters:[10,4,0,30,.001,.001,30],velocityPidBypass:119,inertialBiasAccel:[0,0,0],inertialBiasGyro:[0,0,0]};return{get:i}}angular.module("flybrixCommon").factory("presets",e),e.$inject=["firmwareVersion","parser"]}(),function(){"use strict";function e(e,n,t,r,a){function i(){}function o(e){g=e,g.onRead=d}function u(){return c()}function c(){return f(a.CommandFields.COM_REQ_PARTIAL_EEPROM_DATA,[1,0,0,0])}function f(i,o,u){void 0===u&&(u=!1);var c=n.defer();i|=a.CommandFields.COM_REQ_RESPONSE;var f,l,s=0;if("object"==typeof o){var d=7+o.length;l=new Uint8Array(d),s^=l[1]=a.MessageType.Command;for(var _=0;_<4;++_)s^=l[_+2]=p(i,_);for(var _=0;_<o.length;_++)s^=l[_+6]=o[_]}else{f=new ArrayBuffer(8),l=new Uint8Array(f),s^=l[1]=a.MessageType.Command;for(var _=0;_<4;++_)s^=l[_+2]=p(i,_);s^=l[6]=o}return l[0]=s,l[l.length-1]=0,h.push({mask:i,response:c}),e(function(){g.send(new Uint8Array(t.encode(l)))},0),u&&r("Sending command "+a.MessageType.Command),c.promise}function l(){return g.busy()}function s(e){k=e}function d(e){k?k(e,S):O.AppendToBuffer(e,S,_)}function _(e,n){r("COBS decoding failed ("+e+"): "+n)}function m(e){R=e}function T(e){I=e}function E(e){b=e}function y(e){v=e}function A(e,n){for(;h.length>0;){var t=h.shift();{if(t.mask===e){var r=e;if((r&=~a.CommandFields.COM_REQ_RESPONSE)!==n){t.response.reject("Request was not fully processed");break}t.response.resolve();break}t.response.reject("Missing ACK")}}}function S(e,n,t){a.processBinaryDatastream(e,n,t,R,I,v,b,A)}function p(e,n){return e>>8*n&255}var h=[],g=new i,R=function(){r("No state listener defined for serial")},I=function(){r("No command listener defined for serial")},v=function(){r("No debug listener defined for serial")},b=function(){r("No history listener defined for serial")},O=new t.Reader(2e3),k=void 0;return i.prototype.busy=function(){return!1},i.prototype.send=function(e){r('No "send" defined for serial backend')},i.prototype.onRead=function(e){r('No "onRead" defined for serial backend')},{busy:l,field:a.CommandFields,send:f,setBackend:o,setStateCallback:m,setCommandCallback:T,setDebugCallback:y,setHistoryCallback:E,setDataHandler:s,handlePostConnect:u,Backend:i}}angular.module("flybrixCommon").factory("serial",e),e.$inject=["$timeout","$q","cobs","commandLog","parser"]}(),function(){"use strict";function e(e,n,t,r){function a(){return r.desired()}function i(){return n("Requesting current configuration data..."),e.send(e.field.COM_REQ_PARTIAL_EEPROM_DATA,[255,255,255,255],!1)}function o(){return n("Setting factory default configuration data..."),e.send(e.field.COM_REINIT_EEPROM_DATA,[],!1).then(function(){return i()},function(e){n("Request for factory reset failed: "+e)})}function u(e){return c(65535,65535,e,!1,!0)}function c(n,t,r,a,o){void 0===n&&(n=0),void 0===t&&(t=0),void 0===r&&(r=E);var u=a?e.field.COM_SET_PARTIAL_TEMPORARY_CONFIG:e.field.COM_SET_PARTIAL_EEPROM_DATA,c=f(r,n,t);return e.send(u,c,!1).then(function(){o&&i()})}function f(e,n,a){var i=r.configHandler(),o=new Uint8Array(i.bytecount([a,n])),u=new DataView(o.buffer,0),c=new t.Serializer;return i.encodePartial(u,c,e,[a,n]),o}function l(e){E=r.configHandler().decode(new DataView(e,0),new t.Serializer),d()}function s(e){E=r.configHandler().decodePartial(new DataView(e,0),new t.Serializer,angular.copy(E)),d()}function d(){r.set(E.version),r.supported()?(n("Received configuration data (v"+E.version[0]+"."+E.version[1]+"."+E.version[2]+")"),y()):(n("Received an unsupported configuration!"),n("Found version: "+E.version[0]+"."+E.version[1]+"."+E.version[2]+" --- Newest version: "+r.desiredKey()))}function _(e){y=e}function m(e){A=e}function T(){return E}var E,y=function(){n("No callback defined for receiving configurations!")},A=function(){n("No callback defined for receiving logging state! Callback arguments: (isLogging, isLocked, delay)")},S={VERSION:1,ID:2,PCB:4,MIX_TABLE:8,MAG_BIAS:16,CHANNEL:32,PID_PARAMETERS:64,STATE_PARAMETERS:128,LED_STATES:256,DEVICE_NAME:512,VELOCITY_PID_PARAMETERS:1024,INERTIAL_BIAS:2048};return e.setCommandCallback(function(t,r){if(t&e.field.COM_SET_EEPROM_DATA&&l(r),t&e.field.COM_SET_PARTIAL_EEPROM_DATA&&s(r),t&(e.field.COM_SET_CARD_RECORDING|e.field.COM_SET_SD_WRITE_DELAY)){var a=new Uint8Array(r);if(a.length>=3){var i=a[0]|a[1]<<8,o=a[2];A(0!=(1&o),0!=(2&o),i)}else n("Bad data given for logging info")}}),E=r.configHandler().empty(),{request:i,reinit:o,send:u,sendPartial:c,getConfig:T,setConfigCallback:_,setLoggingCallback:m,getDesiredVersion:a,field:S}}angular.module("flybrixCommon").factory("deviceConfig",e),e.$inject=["serial","commandLog","encodable","firmwareVersion"]}(),function(){"use strict";function e(e){function n(e,n,t,a,c,f,l){c>0&&c<6&&(u.pattern=c),[e,n,t,a].forEach(function(e,n){if(e){var t=o[i[n]];t.red=e.red,t.green=e.green,t.blue=e.blue}}),void 0!==f&&(u.indicator_red=f),void 0!==l&&(u.indicator_green=l),r()}function t(e,t,r){var i={red:e||0,green:t||0,blue:r||0};n(i,i,i,i,a.SOLID)}function r(){e.sendPartial(e.field.LED_STATES,1,c,!0)}var a={NO_OVERRIDE:0,FLASH:1,BEACON:2,BREATHE:3,ALTERNATE:4,SOLID:5},i=["right_front","right_back","left_front","left_back"],o={};i.forEach(function(e){o[e]={red:0,green:0,blue:0}});var u={status:65535,pattern:a.SOLID,colors:o,indicator_red:!1,indicator_green:!1},c={ledStates:[u]};return{set:n,setSimple:t,patterns:a}}angular.module("flybrixCommon").factory("led",e),e.$inject=["deviceConfig"]}(),function(){"use strict";function e(e,n){function t(){if(v||!e.busy()){v=!1;var t={enabled:!0},r={};r.throttle=E(4095*(S- -.8)/1.8,0,4095),r.pitch=E(4095*-y(p,.1)/2,-2047,2047),r.roll=E(4095*y(h,.1)/2,-2047,2047),r.yaw=E(4095*-y(g,.1)/2,-2047,2047),t.command=r,t.auxcode=(1<<R)+(1<<I+3);var a=new Uint8Array(10);return O.encode(new DataView(a.buffer),new n.Serializer,t),e.send(e.field.COM_SET_SERIAL_RC,a,!1)}}function r(e){S=e}function a(e){p=e}function i(e){h=e}function o(e){g=e}function u(e){R=e}function c(e){I=e}function f(){return S}function l(){return p}function s(){return h}function d(){return g}function _(){return R}function m(){return I}function T(){v=!0}function E(e,n,t){return Math.max(n,Math.min(e,t))}function y(e,n){return e>n?e-n:e<-n?e+n:0}var A={LOW:0,MID:1,HIGH:2},S=-1,p=0,h=0,g=0,R=A.HIGH,I=A.HIGH,v=!0,b=n.map([{key:"throttle",element:n.Int16},{key:"pitch",element:n.Int16},{key:"roll",element:n.Int16},{key:"yaw",element:n.Int16}]),O=n.map([{key:"enabled",element:n.bool},{key:"command",element:b},{key:"auxcode",element:n.Uint8}]);return{setThrottle:r,setPitch:a,setRoll:i,setYaw:o,setAux1:u,setAux2:c,getThrottle:f,getPitch:l,getRoll:s,getYaw:d,getAux1:_,getAux2:m,AUX:A,send:t,forceNextSend:T}}angular.module("flybrixCommon").factory("rcData",e),e.$inject=["serial","encodable"]}();