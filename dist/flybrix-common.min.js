!function(){"use strict";angular.module("flybrixCommon",[])}(),function(){"use strict";function e(){return 0}function n(e){var n=c["Uint"+e];if(void 0===n)throw new Error("Unsupported split bit count: "+e+". Allowed counts: 8, 16, 32, 64");return n}function t(e){function n(n,t,a){l.encode(n,t,r(a,e))}function t(n,t){return a(l.decode(n,t),e)}function i(){return""}function f(){return e}var l=o(e,c.Uint8);return new u(f,n,t,i)}function r(e,n){var t=new Uint8Array(n);return e.split("").forEach(function(e,n){t[n]=e.charCodeAt(0)}),t[n-1]=0,t}function a(e,n){for(var t="",r=Math.min(e.length,n-1),a=0;a<r;++a){if(0===e[a])return t;t+=String.fromCharCode(e[a])}return t}function o(e,t,r){function a(n,r,a){for(var o=0;o<e;++o)t.encode(n,r,a[o])}function o(n,r){for(var a=[],o=0;o<e;++o)a.push(t.decode(n,r));return a}function i(){for(var n=[],r=0;r<e;++r)n.push(t.empty());return n}function f(n,r,a,o){var i=o.pop();d.encode(n,r,i);for(var f=0;f<e;++f)i&1<<f&&t.encodePartial(n,r,a[f],o)}function c(n,r,a){for(var o=d.decode(n,r),i=[],f=0;f<e;++f)o&1<<f?i.push(t.decodePartial(n,r,a[f])):i.push(a[f]);return i}function l(n){var a,o=!0;void 0!==n&&(a=n.pop(),o=!1);for(var i=o?0:r/8,f=0;f<e;++f)(o||a&1<<f)&&(i+=t.bytecount(n));return i}function f(n,r,a,o){for(var i=0;i<e;++i)t.encodePartial(n,r,a[i],o)}function c(n,r,a){for(var o=[],i=0;i<e;++i)o.push(t.decodePartial(n,r,a[i]));return o}function l(n){for(var r=0,a=0;a<e;++a)r+=t.bytecount(n);return r}if(void 0===e)throw new Error("Array type requires length");if(!(t instanceof u))throw new Error("Array type requires Handler type as element");var s;if(void 0!==r){var d=n(r);s=new u(l,a,o,i,f,c)}else s=new u(l,a,o,i,f,c);return s.children={element:t,count:e},s}function i(e,t){function r(n,t,r){e.forEach(function(e,a){e.encode(n,t,r[a])})}function a(n,t){var r=[];return e.forEach(function(e,a){r.push(e.decode(n,t))}),r}function o(){var n=[];return e.forEach(function(e){n.push(e.empty())}),n}function i(n,t,r,a){var o=a.pop();d.encode(n,t,o),e.forEach(function(e,i){o&1<<i&&e.encodePartial(n,t,r[i],a)})}function f(n,t,r){var a=d.decode(n,t),o=[];return e.forEach(function(e,i){a&1<<i?o.push(e.decodePartial(n,t,r[i])):o.push(r[i])}),o}function c(n){var r,a=!0;return void 0!==n&&(r=n.pop(),a=!1),e.reduce(function(e,t,o){return a||r&1<<o?e+t.bytecount(n):e},a?0:t/8)}function i(n,t,r,a){e.forEach(function(e,o){e.encodePartial(n,t,r[o],a)})}function f(n,t,r){var a=[];return e.forEach(function(e,o){a.push(e.decodePartial(n,t,r[o]))}),a}function c(n){return e.reduce(function(e,t){return e+t.bytecount(n)},0)}var l=e.length;if(void 0===l)throw new Error("Polyarray type requires an array of Handler objects");e.forEach(function(e){if(!(e instanceof u))throw new Error("Polyarray type requires an array of Handler objects")});var s;e.reduce(function(e,n){return e+n.bytecount},0);if(void 0!==t){var d=n(t);s=new u(c,r,a,o,i,f)}else s=new u(c,r,a,o,i,f);return s.children=e,s}function f(e,t){function r(n,t,r){e.forEach(function(e){e.element.encode(n,t,r[e.key])})}function a(n,t){var r={};return e.forEach(function(e){r[e.key]=e.element.decode(n,t)}),r}function o(){var n={};return e.forEach(function(e){n[e.key]=e.element.empty()}),n}function i(n,t,r,a){var o=a.pop();d.encode(n,t,o),e.forEach(function(e){o&1<<e.part&&e.element.encodePartial(n,t,r[e.key],a)})}function f(n,t,r){var a=d.decode(n,t),o={};return e.forEach(function(e){a&1<<e.part?o[e.key]=e.element.decodePartial(n,t,r[e.key]):o[e.key]=r[e.key]}),o}function c(n){var r,a=!0;return void 0!==n&&(r=n.pop(),a=!1),e.reduce(function(e,t){return a||r&1<<t.part?e+t.element.bytecount(n):e},a?0:t/8)}function i(n,t,r,a){e.forEach(function(e){e.element.encodePartial(n,t,r[e.key],a)})}function f(n,t,r){var a={};return e.forEach(function(e){a[e.key]=e.element.decodePartial(n,t,r[e.key])}),a}function c(n){return e.reduce(function(e,t){return e+t.element.bytecount(n)},0)}var l=e.length;if(void 0===l)throw new Error("Map type requires an array of {key: String, element: Handler} maps");e.forEach(function(e){if(void 0===e.key||!(e.element instanceof u))throw new Error("Map type requires an array of {key: String, element: Handler} maps")});var s;if(void 0!==t){var d=n(t);s=new u(c,r,a,o,i,f)}else s=new u(c,r,a,o,i,f);return s.children=e,s}function u(e,n,t,r,a,o){a=a||n,o=o||t,this.bytecount=e,this.encode=n,this.decode=t,this.encodePartial=a,this.decodePartial=o,this.empty=r}angular.module("flybrixCommon").factory("encodable",function(){return c});var c={string:t,map:f,array:o,polyarray:i};["Uint","Int"].forEach(function(n){[1,2,4].forEach(function(t){function r(e,n,r){e["set"+i](n.index,r,1),n.add(t)}function a(e,n){var r=e["get"+i](n.index,1);return n.add(t),r}function o(){return t}var i=n+8*t;c[i]=new u(o,r,a,e)})}),[4,8].forEach(function(n){function t(e,t,r){e["set"+o](t.index,r,1),t.add(n)}function r(e,t){var r=e["get"+o](t.index,1);return t.add(n),r}function a(){return n}var o="Float"+8*n;c[o]=new u(a,t,r,e)}),c.bool=new u(function(){return 1},function(e,n,t){c.Uint8.encode(e,n,t?1:0)},function(e,n){return 0!==c.Uint8.decode(e,n)},function(){return!1})}(),function(){"use strict";function e(e){var n={},t=e,r=t.map([{key:"red",element:t.Uint8},{key:"green",element:t.Uint8},{key:"blue",element:t.Uint8}]),a=t.map([{key:"status",element:t.Uint16},{key:"pattern",element:t.Uint8},{key:"colors",element:t.map([{key:"right_front",element:r},{key:"right_back",element:r},{key:"left_front",element:r},{key:"left_back",element:r}])},{key:"indicator_red",element:t.bool},{key:"indicator_green",element:t.bool}]),o=t.array(3,t.Float32),i=(t.array(3,t.Uint8),t.array(6,t.Uint8)),f=t.array(6,t.Uint16),u=t.array(7,t.Float32),c=t.array(2,t.Float32),l=t.array(16,a,16),s=(t.string(9),[{part:0,key:"version",element:t.array(3,t.Uint8)},{part:1,key:"id",element:t.Uint32},{part:2,key:"pcbOrientation",element:o},{part:2,key:"pcbTranslation",element:o},{part:3,key:"mixTableFz",element:t.array(8,t.Int8)},{part:3,key:"mixTableTx",element:t.array(8,t.Int8)},{part:3,key:"mixTableTy",element:t.array(8,t.Int8)},{part:3,key:"mixTableTz",element:t.array(8,t.Int8)},{part:4,key:"magBias",element:o},{part:5,key:"assignedChannel",element:i},{part:5,key:"commandInversion",element:t.Uint8},{part:5,key:"channelMidpoint",element:f},{part:5,key:"channelDeadzone",element:f},{part:6,key:"thrustMasterPIDParameters",element:u},{part:6,key:"pitchMasterPIDParameters",element:u},{part:6,key:"rollMasterPIDParameters",element:u},{part:6,key:"yawMasterPIDParameters",element:u},{part:6,key:"thrustSlavePIDParameters",element:u},{part:6,key:"pitchSlavePIDParameters",element:u},{part:6,key:"rollSlavePIDParameters",element:u},{part:6,key:"yawSlavePIDParameters",element:u},{part:6,key:"pidBypass",element:t.Uint8},{part:7,key:"stateEstimationParameters",element:c},{part:7,key:"enableParameters",element:c},{part:8,key:"ledStates",element:l},{part:9,key:"name",element:t.string(9)}]);n["1.4.0"]=t.map(s.slice(),16);var d=[{part:6,key:"thrustGain",element:t.Float32},{part:6,key:"pitchGain",element:t.Float32},{part:6,key:"rollGain",element:t.Float32},{part:6,key:"yawGain",element:t.Float32}];return s=s.slice(0,21).concat(d,s.slice(21)),n["1.5.0"]=t.map(s.slice(),16),n}angular.module("flybrixCommon").factory("configHandler",e),e.$inject=["encodable"]}(),function(){"use strict";function e(e){var n=[0,0,0],t="0.0.0",r={"1.4.0":!0,"1.5.0":!0},a=[1,5,0],o="1.5.0",i=e[o],f=i,u={"1.4.0":134217727,"1.5.0":134217727},c=4294967295;return{set:function(r){n=r,t=r.join("."),f=e[t]||i,c=u[t]||4294967295},get:function(){return n},key:function(){return t},supported:function(){return r[t]===!0},desired:function(){return a},desiredKey:function(){return o},configHandler:function(){return f},stateMask:function(){return c}}}angular.module("flybrixCommon").factory("firmwareVersion",e),e.$inject=["configHandler"]}(),function(){"use strict";function e(){return{Reader:n,encode:r}}function n(e){void 0===e&&(e=2e3),this.N=e,this.buffer=new Uint8Array(e),this.ready_for_new_message=!0,this.buffer_length=0}function t(e){for(var n=0,t=0,r=0,a=!1;e.buffer[n];)r?(--r,e.buffer[t++]=e.buffer[n++]):(a&&(e.buffer[t++]=0),r=e.buffer[n++]-1,a=r<254);return r?0:t}function r(e){for(var n=new Uint8Array(Math.floor((255*e.byteLength+761)/254)),t=1,r=0,a=0;a<e.length;++a){254==n[r]&&(n[r]=255,r=t++,n[r]=0);var o=e[a];++n[r],o?n[t++]=o:(r=t++,n[r]=0)}return n.subarray(0,t).slice().buffer}angular.module("flybrixCommon").factory("cobs",e),n.prototype.AppendToBuffer=function(e,n,r){for(var a=0;a<e.length;a++){var o=e[a];if(this.ready_for_new_message&&(this.ready_for_new_message=!1,this.buffer_length=0),this.buffer[this.buffer_length++]=o,o&&this.buffer_length==this.N)r("overflow","buffer overflow in COBS decoding"),this.ready_for_new_message=!0;else if(!o){this.buffer_length=t(this);var i=0===this.buffer_length;i&&(this.buffer[0]=1);for(var f=1;f<this.buffer_length;++f)this.buffer[0]^=this.buffer[f];if(0===this.buffer[0])if(this.ready_for_new_message=!0,this.buffer_length>5){for(var u=this.buffer[1],c=0,l=0;l<4;++l)c|=this.buffer[l+2]<<8*l;n(u,c,this.buffer.subarray(6,this.buffer_length).slice().buffer)}else r("short","Too short packet");else{this.ready_for_new_message=!0;for(var s="",d="",f=0;f<this.buffer_length;f++)s+=this.buffer[f]+",",d+=String.fromCharCode(this.buffer[f]);if(i)r("frame","Unexpected ending of packet");else{var _="BAD CHECKSUM ("+this.buffer_length+" bytes)"+s+d;r("checksum",_)}}}}}}(),function(){"use strict";function e(e){function n(e){void 0!==e&&(o.push(e),i.notify(t()))}function t(){return o}function r(){i=e.defer()}function a(e){return i.promise.then(void 0,void 0,e)}var o=[],i=e.defer(),f=n;return f.log=n,f.clearSubscribers=r,f.onMessage=a,f.read=t,f}angular.module("flybrixCommon").factory("commandLog",e),e.$inject=["$q"]}(),function(){"use strict";function e(){return n}function n(){this.index=0}angular.module("flybrixCommon").factory("serializer",e),n.prototype.add=function(e){this.index+=e},[["Float32",4],["Int16",2],["Int8",1],["Uint8",1],["Uint16",2]].forEach(function(e){var t=e[0],r=e[1],a="get"+t,o="set"+t;n.prototype["parse"+t+"Array"]=function(e,n){for(var t=0;t<n.length;t++)n[t]=e[a](this.index,1),this.add(r)},n.prototype["set"+t+"Array"]=function(e,n){for(var t=0;t<n.length;t++)e[o](this.index,n[t],1),this.add(r)}})}(),function(){"use strict";function e(e,n,t,r){function a(e,n,t,r,a,i){o(e,n,t,function(){f(n,t,r)},a,i)}function o(n,t,r,a,o,f){switch(n){case u.State:a(t,r);break;case u.Command:o(t,r);break;case u.DebugString:var c=i(r);e('Received <span style="color: orange">DEBUG</span>: '+c);break;case u.HistoryData:var c=i(r);e('Received <span style="color: orange">HISTORY DATA</span>');break;case u.Response:var l=new DataView(r,0);f(t,l.getInt32(0,1))}}function i(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function f(e,t,a){var o=_.empty(),i=[],f=new DataView(t,0),u=new n,c=0;e&=r.stateMask(),_.children.forEach(function(n,t){var r=1<<t;if(e&r){i[t]=!0;var a=n.element,c=n.key;o[c]=a.decode(f,u)}}),e&l.STATE_MICROS&&(c=1e6/(o.timestamp_us-d),d=o.timestamp_us),e&l.STATE_TEMPERATURE&&(o.temperature/=100),e&l.STATE_PRESSURE&&(o.pressure/=256),a(o,i,c)}var u={State:0,Command:1,DebugString:3,HistoryData:4,Response:255},c={COM_REQ_RESPONSE:1,COM_SET_EEPROM_DATA:2,COM_REINIT_EEPROM_DATA:4,COM_REQ_EEPROM_DATA:8,COM_REQ_ENABLE_ITERATION:16,COM_MOTOR_OVERRIDE_SPEED_0:32,COM_MOTOR_OVERRIDE_SPEED_1:64,COM_MOTOR_OVERRIDE_SPEED_2:128,COM_MOTOR_OVERRIDE_SPEED_3:256,COM_MOTOR_OVERRIDE_SPEED_4:512,COM_MOTOR_OVERRIDE_SPEED_5:1024,COM_MOTOR_OVERRIDE_SPEED_6:2048,COM_MOTOR_OVERRIDE_SPEED_7:4096,COM_MOTOR_OVERRIDE_SPEED_ALL:8160,COM_SET_COMMAND_OVERRIDE:8192,COM_SET_STATE_MASK:16384,COM_SET_STATE_DELAY:32768,COM_SET_SD_WRITE_DELAY:65536,COM_SET_LED:1<<17,COM_SET_SERIAL_RC:1<<18,COM_SET_CARD_RECORDING:1<<19,COM_SET_PARTIAL_EEPROM_DATA:1<<20,COM_REINIT_PARTIAL_EEPROM_DATA:1<<21,COM_REQ_PARTIAL_EEPROM_DATA:1<<22,COM_REQ_CARD_RECORDING_STATE:1<<23,COM_SET_PARTIAL_TEMPORARY_CONFIG:1<<24},l={STATE_ALL:4294967295,STATE_NONE:0,STATE_MICROS:1,STATE_STATUS:2,STATE_V0:4,STATE_I0:8,STATE_I1:16,STATE_ACCEL:32,STATE_GYRO:64,STATE_MAG:128,STATE_TEMPERATURE:256,STATE_PRESSURE:512,STATE_RX_PPM:1024,STATE_AUX_CHAN_MASK:2048,STATE_COMMANDS:4096,STATE_F_AND_T:8192,STATE_PID_FZ_MASTER:32768,STATE_PID_TX_MASTER:65536,STATE_PID_TY_MASTER:1<<17,STATE_PID_TZ_MASTER:1<<18,STATE_PID_FZ_SLAVE:1<<19,STATE_PID_TX_SLAVE:1<<20,STATE_PID_TY_SLAVE:1<<21,STATE_PID_TZ_SLAVE:1<<22,STATE_MOTOR_OUT:1<<23,STATE_KINE_ANGLE:1<<24,STATE_KINE_RATE:1<<25,STATE_KINE_ALTITUDE:1<<26,STATE_LOOP_COUNT:1<<27},s={STATUS_BOOT:1,STATUS_MPU_FAIL:2,STATUS_BMP_FAIL:4,STATUS_RX_FAIL:8,STATUS_IDLE:16,STATUS_ENABLING:32,STATUS_CLEAR_MPU_BIAS:64,STATUS_SET_MPU_BIAS:128,STATUS_FAIL_STABILITY:256,STATUS_FAIL_ANGLE:512,STATUS_ENABLED:1024,STATUS_BATTERY_LOW:2048,STATUS_TEMP_WARNING:4096,STATUS_LOG_FULL:8192,STATUS_UNPAIRED:16384,STATUS_OVERRIDE:32768},d=0,_=function(){var e=t,n=e.polyarray([e.Uint32,e.Float32,e.Float32,e.Float32,e.Float32,e.Float32]);return e.map([{key:"timestamp_us",element:e.Uint32},{key:"status",element:e.Uint16},{key:"V0_raw",element:e.Uint16},{key:"I0_raw",element:e.Uint16},{key:"I1_raw",element:e.Uint16},{key:"accel",element:e.array(3,e.Float32)},{key:"gyro",element:e.array(3,e.Float32)},{key:"mag",element:e.array(3,e.Float32)},{key:"temperature",element:e.Uint16},{key:"pressure",element:e.Uint32},{key:"ppm",element:e.array(6,e.Int16)},{key:"AUX_chan_mask",element:e.Uint8},{key:"command",element:e.array(4,e.Int16)},{key:"control",element:e.array(4,e.Float32)},{key:"UNUSED",element:e.map([])},{key:"pid_master_Fz",element:n},{key:"pid_master_Tx",element:n},{key:"pid_master_Ty",element:n},{key:"pid_master_Tz",element:n},{key:"pid_slave_Fz",element:n},{key:"pid_slave_Tx",element:n},{key:"pid_slave_Ty",element:n},{key:"pid_slave_Tz",element:n},{key:"MotorOut",element:e.array(8,e.Int16)},{key:"kinematicsAngle",element:e.array(3,e.Float32)},{key:"kinematicsRate",element:e.array(3,e.Float32)},{key:"kinematicsAltitude",element:e.Float32},{key:"loopCount",element:e.Uint32}])}();return{processBinaryDatastream:a,MessageType:u,CommandFields:c,StatusCodes:s}}angular.module("flybrixCommon").factory("parser",e),e.$inject=["commandLog","serializer","encodable","firmwareVersion"]}(),function(){"use strict";function e(e,n,t,r,a){function o(){}function i(e){A=e,A.onRead=l}function f(o,i,f){void 0===f&&(f=!0);var u=n.defer();o|=a.CommandFields.COM_REQ_RESPONSE;var c,l,s=0;if("object"==typeof i){var d=7+i.length;l=new Uint8Array(d),s^=l[1]=a.MessageType.Command;for(var _=0;_<4;++_)s^=l[_+2]=E(o,_);for(var _=0;_<i.length;_++)s^=l[_+6]=i[_]}else{c=new ArrayBuffer(8),l=new Uint8Array(c),s^=l[1]=a.MessageType.Command;for(var _=0;_<4;++_)s^=l[_+2]=E(o,_);s^=l[6]=i}return l[0]=s,l[l.length-1]=0,T.push({mask:o,response:u}),e(function(){A.send(new Uint8Array(t.encode(l)))},0),f&&r('Sending command <span style="color:blue">'+a.MessageType.Command+"</blue>"),u.promise}function u(){return A.busy()}function c(e){g=e}function l(e){g?g(e,y):h.AppendToBuffer(e,y,s)}function s(e,n){r("COBS decoding failed ("+e+"): "+n)}function d(e){p=e}function _(e){S=e}function m(e,n){for(;T.length>0;){var t=T.shift();{if(t.mask===e){var r=e;if(r&=~a.CommandFields.COM_REQ_RESPONSE,r!==n){t.response.reject("Request was not fully processed");break}t.response.resolve();break}t.response.reject("Missing ACK")}}}function y(e,n,t){a.processBinaryDatastream(e,n,t,p,S,m)}function E(e,n){return e>>8*n&255}var T=[],A=new o,p=function(){r("No state listener defined for serial")},S=function(){r("No command listener defined for serial")},h=new t.Reader(2e3),g=void 0;return o.prototype.busy=function(){return!1},o.prototype.send=function(e){r('No "send" defined for serial backend')},o.prototype.onRead=function(e){r('No "onRead" defined for serial backend')},{busy:u,field:a.CommandFields,send:f,setBackend:i,setStateCallback:d,setCommandCallback:_,setDataHandler:c,Backend:o}}angular.module("flybrixCommon").factory("serial",e),e.$inject=["$timeout","$q","cobs","commandLog","parser"]}(),function(){"use strict";function e(e,n,t,r,a){function o(){return a.desired()}function i(){n("Requesting current configuration data..."),e.send(e.field.COM_REQ_EEPROM_DATA,[],!1)}function f(){n("Setting factory default configuration data..."),e.send(e.field.COM_REINIT_EEPROM_DATA,[],!1).then(function(){i()},function(e){n("Request for factory reset failed: "+e)})}function u(t){void 0===t&&(t=A),n("Sending new configuration data...");var r=l(t);e.send(e.field.COM_SET_EEPROM_DATA,r,!1).then(function(){i()})}function c(n,t,r,a,o){void 0===n&&(n=0),void 0===t&&(t=0),void 0===r&&(r=A);var f=a?e.field.COM_SET_PARTIAL_TEMPORARY_CONFIG:e.field.COM_SET_PARTIAL_EEPROM_DATA,u=s(r,n,t);e.send(f,u,!1).then(function(){o&&i()})}function l(e){var n=a.configHandler(),r=new Uint8Array(n.bytecount()),o=new DataView(r.buffer,0);return n.encode(o,new t,e),r}function s(e,n,r){var o=a.configHandler(),i=new Uint8Array(o.bytecount([r,n])),f=new DataView(i.buffer,0),u=new t;return o.encodePartial(f,u,e,[r,n]),i}function d(e){n("Received config!"),A=a.configHandler().decode(new DataView(e,0),new t),m()}function _(e){n("Received partial config!"),A=a.configHandler().decodePartial(new DataView(e,0),new t,angular.copy(A)),m()}function m(){a.set(A.version),a.supported()?(n('Recieved configuration version: <span style="color: green">'+A.version[0]+"."+A.version[1]+"."+A.version[2]+"</span>"),p()):(n('<span style="color: red">WARNING: Configuration version unsupported!</span>'),n("eeprom version: <strong>"+A.version[0]+"."+A.version[1]+"."+A.version[2]+"</strong> - newest firmware version: <strong>"+a.desiredKey()+"</strong>"))}function y(e){p=e}function E(e){S=e}function T(){return A}var A,p=function(){n("No callback defined for receiving configurations!")},S=function(){n("No callback defined for receiving logging state! Callback arguments: (isLogging, isLocked, delay)")},h={VERSION:1,ID:2,PCB:4,MIX_TABLE:8,MAG_BIAS:16,CHANNEL:32,PID_PARAMETERS:64,STATE_PARAMETERS:128,LED_STATES:256,DEVICE_NAME:512};return e.setCommandCallback(function(t,r){if(t&e.field.COM_SET_EEPROM_DATA&&d(r),t&e.field.COM_SET_PARTIAL_EEPROM_DATA&&_(r),t&(e.field.COM_SET_CARD_RECORDING|e.field.COM_SET_SD_WRITE_DELAY)){var a=new Uint8Array(r);if(a.length>=3){var o=a[0]|a[1]<<8,i=a[2];S(0!==(1&i),0!==(2&i),o)}else n("Bad data given for logging info")}}),A=a.configHandler().empty(),{request:i,reinit:f,send:u,sendPartial:c,getConfig:T,setConfigCallback:y,setLoggingCallback:E,getDesiredVersion:o,field:h}}angular.module("flybrixCommon").factory("deviceConfig",e),e.$inject=["serial","commandLog","serializer","encodable","firmwareVersion"]}(),function(){"use strict";function e(e){function n(e,n,t,a,u,c,l){u>0&&u<6&&(f.pattern=u),[e,n,t,a].forEach(function(e,n){if(e){var t=i[o[n]];t.red=e.red,t.green=e.green,t.blue=e.blue}}),void 0!==c&&(f.indicator_red=c),void 0!==l&&(f.indicator_green=l),r()}function t(e,t,r){var o={red:e||0,green:t||0,blue:r||0};n(o,o,o,o,a.SOLID)}function r(){e.sendPartial(e.field.LED_STATES,1,u,!0)}var a={NO_OVERRIDE:0,FLASH:1,BEACON:2,BREATHE:3,ALTERNATE:4,SOLID:5},o=["right_front","right_back","left_front","left_back"],i={};o.forEach(function(e){i[e]={red:0,green:0,blue:0}});var f={status:65535,pattern:a.SOLID,colors:i,indicator_red:!1,indicator_green:!1},u={ledStates:[f]};return{set:n,setSimple:t,patterns:a}}angular.module("flybrixCommon").factory("led",e),e.$inject=["deviceConfig"]}(),function(){"use strict";function e(e,n,t){function r(){if(O||!e.busy()){O=!1;var t={enabled:!0},r={},a=-.8;r.throttle=T(4095*(S-a)/(1-a),0,4095),r.pitch=T(4095*-A(h,.1)/2,-2047,2047),r.roll=T(4095*A(g,.1)/2,-2047,2047),r.yaw=T(4095*-A(v,.1)/2,-2047,2047),t.command=r,t.auxcode=(1<<R)+(1<<k+3);var o=new Uint8Array(10);return C.encode(new DataView(o.buffer),new n,t),e.send(e.field.COM_SET_SERIAL_RC,o,!1)}}function a(e){S=e}function o(e){h=e}function i(e){g=e}function f(e){v=e}function u(e){R=e}function c(e){k=e}function l(){return S}function s(){return h}function d(){return g}function _(){return v}function m(){return R}function y(){return k}function E(){O=!0}function T(e,n,t){return Math.max(n,Math.min(e,t))}function A(e,n){return e>n?e-n:e<-n?e+n:0}var p={LOW:0,MID:1,HIGH:2},S=-1,h=0,g=0,v=0,R=p.HIGH,k=p.HIGH,O=!0,b=t.map([{key:"throttle",element:t.Int16},{key:"pitch",element:t.Int16},{key:"roll",element:t.Int16},{key:"yaw",element:t.Int16}]),C=t.map([{key:"enabled",element:t.bool},{key:"command",element:b},{key:"auxcode",element:t.Uint8}]);return{setThrottle:a,setPitch:o,setRoll:i,setYaw:f,setAux1:u,setAux2:c,getThrottle:l,getPitch:s,getRoll:d,getYaw:_,getAux1:m,getAux2:y,AUX:p,send:r,forceNextSend:E}}angular.module("flybrixCommon").factory("rcData",e),e.$inject=["serial","serializer","encodable"]}();