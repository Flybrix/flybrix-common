!function(){"use strict";angular.module("flybrixCommon",[])}(),function(){"use strict";function e(e,t){var r=d[e];if(void 0===r)throw new Error('Unsupported type: "'+e+'". Allowed types: number, string, map, array.');this.handler=r(t)}function t(e){var t=_[e];if(void 0===t)throw new Error('Unsupported number type: "'+e+'". Allowed number types: (Uint|Int)(8|16|32|64), eg. Uint16.');return t}function r(t){function r(e,r,a){d.encode(e,r,n(a,t))}function s(e,r){return a(d.decode(e,r),t)}var d=i({count:t,element:new e("number","Uint8")});return new o(r,s)}function n(e,t){var r=new Uint8Array(t);return e.split("").forEach(function(e,t){r[t]=e.charCodeAt(0)}),r[t-1]=0,r}function a(e,t){for(var r="",n=Math.min(e.length,t-1),a=0;a<n;++a){if(0===e[a])return r;r+=String.fromCharCode(e[a])}return r}function i(t){function r(e,t,r){for(var n=0;n<a;++n)i.encode(e,t,r[n])}function n(e,t){for(var r=[],n=0;n<a;++n)r.push(i.decode(e,t));return r}var a=t.count,i=t.element;if(void 0===a)throw new Error('Array type requires "count" in its property object');if(!(i instanceof e))throw new Error('Array type requires Encodable type as "element" in its property object');return new o(r,n)}function s(t){function r(e,r,n){t.forEach(function(t){t.element.encode(e,r,n[t.key])})}function n(e,r){var n={};return t.forEach(function(t){n[t.key]=t.element.decode(e,r)}),n}var a=t.length;if(void 0===a)throw new Error("Map type requires an array of {key: String, element: Encoder} maps");return t.forEach(function(t){if(void 0===t.key||!(t.element instanceof e))throw new Error("Map type requires an array of {key: String, element: Encoder} maps")}),new o(r,n)}function o(e,t){this.encode=e,this.decode=t}angular.module("flybrixCommon").factory("encodable",function(){return e});var d={number:t,string:r,map:s,array:i};e.prototype={decode:function(e,t){return this.handler.decode(e,t)},encode:function(e,t,r){this.handler.encode(e,t,r)}};var _={};["Uint","Int"].forEach(function(e){[1,2,4].forEach(function(t){function r(e,r,n){e["set"+a](r.index,n,1),r.add(t)}function n(e,r){var n=e["get"+a](r.index,1);return r.add(t),n}var a=e+8*t;_[a]=new o(r,n)})}),[4,8].forEach(function(e){function t(t,r,a){t["set"+n](r.index,a,1),r.add(e)}function r(t,r){var a=t["get"+n](r.index,1);return r.add(e),a}var n="Float"+8*e;_[n]=new o(t,r)})}(),function(){"use strict";function e(){return{Reader:t,encode:n}}function t(e){void 0===e&&(e=2e3),this.N=e,this.buffer=new Uint8Array(e),this.ready_for_new_message=!0,this.buffer_length=0}function r(e){for(var t=0,r=0,n=0,a=!1;e.buffer[t];)n?(--n,e.buffer[r++]=e.buffer[t++]):(a&&(e.buffer[r++]=0),n=e.buffer[t++]-1,a=n<254);return n?0:r}function n(e){for(var t=new Uint8Array(Math.floor((255*e.byteLength+761)/254)),r=1,n=0,a=0;a<e.length;++a){254==t[n]&&(t[n]=255,n=r++,t[n]=0);var i=e[a];++t[n],i?t[r++]=i:(n=r++,t[n]=0)}return t.subarray(0,r).slice().buffer}angular.module("flybrixCommon").factory("cobs",e),t.prototype.AppendToBuffer=function(e,t,n){for(var a=0;a<e.length;a++){var i=e[a];if(this.ready_for_new_message&&(this.ready_for_new_message=!1,this.buffer_length=0),this.buffer[this.buffer_length++]=i,i&&this.buffer_length==this.N)n("overflow","buffer overflow in COBS decoding"),this.ready_for_new_message=!0;else if(!i){this.buffer_length=r(this);var s=0===this.buffer_length;s&&(this.buffer[0]=1);for(var o=1;o<this.buffer_length;++o)this.buffer[0]^=this.buffer[o];if(0===this.buffer[0])if(this.ready_for_new_message=!0,this.buffer_length>5){for(var d=this.buffer[1],_=0,l=0;l<4;++l)_|=this.buffer[l+2]<<8*l;t(d,_,this.buffer.subarray(6,this.buffer_length).slice().buffer)}else n("short","Too short packet");else{this.ready_for_new_message=!0;for(var f="",c="",o=0;o<this.buffer_length;o++)f+=this.buffer[o]+",",c+=String.fromCharCode(this.buffer[o]);if(s)n("frame","Unexpected ending of packet");else{var A="BAD CHECKSUM ("+this.buffer_length+" bytes)"+f+c;n("checksum",A)}}}}}}(),function(){"use strict";function e(e){function t(e){void 0!==e&&(i.push(e),s.notify(r()))}function r(){return i}function n(){s=e.defer()}function a(e){return s.promise.then(void 0,void 0,e)}var i=[],s=e.defer(),o=t;return o.log=t,o.clearSubscribers=n,o.onMessage=a,o.read=r,o}angular.module("flybrixCommon").factory("commandLog",e),e.$inject=["$q"]}(),function(){"use strict";function e(){return t}function t(){this.index=0}angular.module("flybrixCommon").factory("serializer",e),t.prototype.add=function(e){this.index+=e},[["Float32",4],["Int16",2],["Int8",1],["Uint8",1],["Uint16",2]].forEach(function(e){var r=e[0],n=e[1],a="get"+r,i="set"+r;t.prototype["parse"+r+"Array"]=function(e,t){for(var r=0;r<t.length;r++)t[r]=e[a](this.index,1),this.add(n)},t.prototype["set"+r+"Array"]=function(e,t){for(var r=0;r<t.length;r++)e[i](this.index,t[r],1),this.add(n)}})}(),function(){"use strict";function e(e,t){function r(){this.timestamp_us=0,this.status=0,this.V0_raw=0,this.I0_raw=0,this.I1_raw=0,this.accel=[0,0,0],this.gyro=[0,0,0],this.mag=[0,0,0],this.temperature=0,this.pressure=0,this.ppm=[0,0,0,0,0,0],this.AUX_chan_mask=0,this.command=[0,0,0,0],this.control=[0,0,0,0],this.pid_master_Fz=[0,0,0,0,0,0],this.pid_master_Tx=[0,0,0,0,0,0],this.pid_master_Ty=[0,0,0,0,0,0],this.pid_master_Tz=[0,0,0,0,0,0],this.pid_slave_Fz=[0,0,0,0,0,0],this.pid_slave_Tx=[0,0,0,0,0,0],this.pid_slave_Ty=[0,0,0,0,0,0],this.pid_slave_Tz=[0,0,0,0,0,0],this.MotorOut=[0,0,0,0,0,0,0,0],this.kinematicsAngle=[0,0,0],this.kinematicsRate=[0,0,0],this.kinematicsAltitude=0,this.loopCount=0}function n(e,t,r,n,i,s){a(e,t,r,function(){o(t,r,n)},i,s)}function a(t,r,n,a,s,o){switch(t){case d.State:a(r,n);break;case d.Command:s(r,n);break;case d.DebugString:var _=i(n);e('Received <span style="color: orange">DEBUG</span>: '+_);break;case d.HistoryData:var _=i(n);e('Received <span style="color: orange">HISTORY DATA</span>');break;case d.Response:var l=new DataView(n,0);o(r,l.getInt32(0,1))}}function i(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function s(e,t,r){t[0]=e.getUint32(r.index,1),r.add(4);for(var n=1;n<6;n++)t[n]=e.getFloat32(r.index,1),r.add(4)}function o(e,n,a){var i=new r,o=[],d=new DataView(n,0),_=new t,f=0;0!=(e&l.STATE_MICROS)&&(o[0]=!0,i.timestamp_us=d.getUint32(_.index,1),_.add(4),f=1e6/(i.timestamp_us-c),c=i.timestamp_us),0!=(e&l.STATE_STATUS)&&(o[1]=!0,i.status=d.getUint16(_.index,1),_.add(2)),0!=(e&l.STATE_V0)&&(o[2]=!0,i.V0_raw=d.getUint16(_.index,1),_.add(2)),0!=(e&l.STATE_I0)&&(o[3]=!0,i.I0_raw=d.getUint16(_.index,1),_.add(2)),0!=(e&l.STATE_I1)&&(o[4]=!0,i.I1_raw=d.getUint16(_.index,1),_.add(2)),0!=(e&l.STATE_ACCEL)&&(o[5]=!0,_.parseFloat32Array(d,i.accel)),0!=(e&l.STATE_GYRO)&&(o[6]=!0,_.parseFloat32Array(d,i.gyro)),0!=(e&l.STATE_MAG)&&(o[7]=!0,_.parseFloat32Array(d,i.mag)),0!=(e&l.STATE_TEMPERATURE)&&(o[8]=!0,i.temperature=d.getUint16(_.index,1)/100,_.add(2)),0!=(e&l.STATE_PRESSURE)&&(o[9]=!0,i.pressure=d.getUint32(_.index,1)/256,_.add(4)),0!=(e&l.STATE_RX_PPM)&&(o[10]=!0,_.parseInt16Array(d,i.ppm)),0!=(e&l.STATE_AUX_CHAN_MASK)&&(o[11]=!0,i.AUX_chan_mask=d.getUint8(_.index,1),_.add(1)),0!=(e&l.STATE_COMMANDS)&&(o[12]=!0,_.parseInt16Array(d,i.command)),0!=(e&l.STATE_F_AND_T)&&(o[13]=!0,_.parseFloat32Array(d,i.control)),0!=(e&l.STATE_PID_FZ_MASTER)&&(o[15]=!0,s(d,i.pid_master_Fz,_)),0!=(e&l.STATE_PID_TX_MASTER)&&(o[16]=!0,s(d,i.pid_master_Tx,_)),0!=(e&l.STATE_PID_TY_MASTER)&&(o[17]=!0,s(d,i.pid_master_Ty,_)),0!=(e&l.STATE_PID_TZ_MASTER)&&(o[18]=!0,s(d,i.pid_master_Tz,_)),0!=(e&l.STATE_PID_FZ_SLAVE)&&(o[19]=!0,s(d,i.pid_slave_Fz,_)),0!=(e&l.STATE_PID_TX_SLAVE)&&(o[20]=!0,s(d,i.pid_slave_Tx,_)),0!=(e&l.STATE_PID_TY_SLAVE)&&(o[21]=!0,s(d,i.pid_slave_Ty,_)),0!=(e&l.STATE_PID_TZ_SLAVE)&&(o[22]=!0,s(d,i.pid_slave_Tz,_)),0!=(e&l.STATE_MOTOR_OUT)&&(o[23]=!0,_.parseInt16Array(d,i.MotorOut)),0!=(e&l.STATE_KINE_ANGLE)&&(o[24]=!0,_.parseFloat32Array(d,i.kinematicsAngle)),0!=(e&l.STATE_KINE_RATE)&&(o[25]=!0,_.parseFloat32Array(d,i.kinematicsRate)),0!=(e&l.STATE_KINE_ALTITUDE)&&(o[26]=!0,i.kinematicsAltitude=d.getFloat32(_.index,1),_.add(4)),0!=(e&l.STATE_LOOP_COUNT)&&(o[27]=!0,i.loopCount=d.getUint32(_.index,1),_.add(4)),a(i,o,f)}var d={State:0,Command:1,DebugString:3,HistoryData:4,Response:255},_={COM_REQ_RESPONSE:1,COM_SET_EEPROM_DATA:2,COM_REINIT_EEPROM_DATA:4,COM_REQ_EEPROM_DATA:8,COM_REQ_ENABLE_ITERATION:16,COM_MOTOR_OVERRIDE_SPEED_0:32,COM_MOTOR_OVERRIDE_SPEED_1:64,COM_MOTOR_OVERRIDE_SPEED_2:128,COM_MOTOR_OVERRIDE_SPEED_3:256,COM_MOTOR_OVERRIDE_SPEED_4:512,COM_MOTOR_OVERRIDE_SPEED_5:1024,COM_MOTOR_OVERRIDE_SPEED_6:2048,COM_MOTOR_OVERRIDE_SPEED_7:4096,COM_MOTOR_OVERRIDE_SPEED_ALL:8160,COM_SET_COMMAND_OVERRIDE:8192,COM_SET_STATE_MASK:16384,COM_SET_STATE_DELAY:32768,COM_SET_SD_WRITE_DELAY:65536,COM_SET_LED:1<<17,COM_SET_SERIAL_RC:1<<18,COM_SET_CARD_RECORDING:1<<19,COM_SET_PARTIAL_EEPROM_DATA:1<<20,COM_REINIT_PARTIAL_EEPROM_DATA:1<<21,COM_REQ_PARTIAL_EEPROM_DATA:1<<22,COM_REQ_CARD_RECORDING_STATE:1<<23,COM_SET_PARTIAL_TEMPORARY_CONFIG:1<<24},l={STATE_ALL:4294967295,STATE_NONE:0,STATE_MICROS:1,STATE_STATUS:2,STATE_V0:4,STATE_I0:8,STATE_I1:16,STATE_ACCEL:32,STATE_GYRO:64,STATE_MAG:128,STATE_TEMPERATURE:256,STATE_PRESSURE:512,STATE_RX_PPM:1024,STATE_AUX_CHAN_MASK:2048,STATE_COMMANDS:4096,STATE_F_AND_T:8192,STATE_PID_FZ_MASTER:32768,STATE_PID_TX_MASTER:65536,STATE_PID_TY_MASTER:1<<17,STATE_PID_TZ_MASTER:1<<18,STATE_PID_FZ_SLAVE:1<<19,STATE_PID_TX_SLAVE:1<<20,STATE_PID_TY_SLAVE:1<<21,STATE_PID_TZ_SLAVE:1<<22,STATE_MOTOR_OUT:1<<23,STATE_KINE_ANGLE:1<<24,STATE_KINE_RATE:1<<25,STATE_KINE_ALTITUDE:1<<26,STATE_LOOP_COUNT:1<<27},f={STATUS_BOOT:1,STATUS_MPU_FAIL:2,STATUS_BMP_FAIL:4,STATUS_RX_FAIL:8,STATUS_IDLE:16,STATUS_ENABLING:32,STATUS_CLEAR_MPU_BIAS:64,STATUS_SET_MPU_BIAS:128,STATUS_FAIL_STABILITY:256,STATUS_FAIL_ANGLE:512,STATUS_ENABLED:1024,STATUS_BATTERY_LOW:2048,STATUS_TEMP_WARNING:4096,STATUS_LOG_FULL:8192,STATUS_UNPAIRED:16384,STATUS_OVERRIDE:32768},c=0;return{processBinaryDatastream:n,MessageType:d,CommandFields:_,StatusCodes:f}}angular.module("flybrixCommon").factory("parser",e),e.$inject=["commandLog","serializer"]}(),function(){"use strict";function e(e,t,r,n,a){function i(){}function s(e){S=e,S.onRead=l}function o(i,s,o){void 0===o&&(o=!0);var d=t.defer();i|=a.CommandFields.COM_REQ_RESPONSE;var _,l,f=0;if("object"==typeof s){var c=7+s.length;l=new Uint8Array(c),f^=l[1]=a.MessageType.Command;for(var A=0;A<4;++A)f^=l[A+2]=E(i,A);for(var A=0;A<s.length;A++)f^=l[A+6]=s[A]}else{_=new ArrayBuffer(8),l=new Uint8Array(_),f^=l[1]=a.MessageType.Command;for(var A=0;A<4;++A)f^=l[A+2]=E(i,A);f^=l[6]=s}return l[0]=f,l[l.length-1]=0,m.push({mask:i,response:d}),e(function(){S.send(new Uint8Array(r.encode(l)))},0),o&&n('Sending command <span style="color:blue">'+a.MessageType.Command+"</blue>"),d.promise}function d(){return S.busy()}function _(e){g=e}function l(e){g?g(e,T):p.AppendToBuffer(e,T,f)}function f(e,t){n("COBS decoding failed ("+e+"): "+t)}function c(e){h=e}function A(e){y=e}function u(e,t){for(;m.length>0;){var r=m.shift();{if(r.mask===e){var n=e;if(n&=~a.CommandFields.COM_REQ_RESPONSE,n!==t){r.response.reject("Request was not fully processed");break}r.response.resolve();break}r.response.reject("Missing ACK")}}}function T(e,t,r){a.processBinaryDatastream(e,t,r,h,y,u)}function E(e,t){return e>>8*t&255}var m=[],S=new i,h=function(){n("No state listener defined for serial")},y=function(){n("No command listener defined for serial")},p=new r.Reader(2e3),g=void 0;return i.prototype.busy=function(){return!1},i.prototype.send=function(e){n('No "send" defined for serial backend')},i.prototype.onRead=function(e){n('No "onRead" defined for serial backend')},{busy:d,field:a.CommandFields,send:o,setBackend:s,setStateCallback:c,setCommandCallback:A,setDataHandler:_,Backend:i}}angular.module("flybrixCommon").factory("serial",e),e.$inject=["$timeout","$q","cobs","commandLog","parser"]}(),function(){"use strict";function e(e,t,r){function n(){return b}function a(){t("Requesting current configuration data..."),e.send(e.field.COM_REQ_EEPROM_DATA,[],!1)}function i(){t("Setting factory default configuration data..."),e.send(e.field.COM_REINIT_EEPROM_DATA,[],!1).then(function(){a()},function(e){t("Request for factory reset failed: "+e)})}function s(r){void 0===r&&(r=M),t("Sending new configuration data...");var n=new ArrayBuffer(O),i=new DataView(n,0);S(i,r);var s=new Uint8Array(n);e.send(e.field.COM_SET_EEPROM_DATA,s,!1).then(function(){a()})}function o(t,r,n,i,s){void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=M);var o=i?e.field.COM_SET_PARTIAL_TEMPORARY_CONFIG:e.field.COM_SET_PARTIAL_EEPROM_DATA,d=new ArrayBuffer(O),_=new DataView(d,0),l=h(_,n,t,r),f=new Uint8Array(d.slice(0,l));e.send(o,f,!1).then(function(){s&&a()})}function d(e,t,r){this.red=e,this.green=t,this.blue=r}function _(e,t,r){e.red=r.getUint8(t.index,1),t.add(1),e.green=r.getUint8(t.index,1),t.add(1),e.blue=r.getUint8(t.index,1),t.add(1)}function l(e,t,r){r.setUint8(t.index,e.red),t.add(1),r.setUint8(t.index,e.green),t.add(1),r.setUint8(t.index,e.blue),t.add(1)}function f(){this.status=0,this.pattern=0,this.colors={right_front:new d(0,0,0),right_back:new d(0,0,0),left_front:new d(0,0,0),left_back:new d(0,0,0)},this.indicator_red=!1,this.indicator_green=!1}function c(e,t,r){e.status=r.getUint16(t.index,1),t.add(2),e.pattern=r.getUint8(t.index,1),t.add(1),_(e.colors.right_front,t,r),_(e.colors.right_back,t,r),_(e.colors.left_front,t,r),_(e.colors.left_back,t,r),e.indicator_red=0!==r.getUint8(t.index,1),t.add(1),e.indicator_green=0!==r.getUint8(t.index,1),t.add(1)}function A(e,t,r){r.setUint16(t.index,e.status,1),t.add(2),r.setUint8(t.index,e.pattern),t.add(1),l(e.colors.right_front,t,r),l(e.colors.right_back,t,r),l(e.colors.left_front,t,r),l(e.colors.left_back,t,r),r.setUint8(t.index,e.indicator_red?1:0),t.add(1),r.setUint8(t.index,e.indicator_green?1:0),t.add(1)}function u(){this.version=[0,0,0],this.id=0,this.pcbOrientation=[0,0,0],this.pcbTranslation=[0,0,0],this.mixTableFz=[0,0,0,0,0,0,0,0],this.mixTableTx=[0,0,0,0,0,0,0,0],this.mixTableTy=[0,0,0,0,0,0,0,0],this.mixTableTz=[0,0,0,0,0,0,0,0],this.magBias=[0,0,0],this.assignedChannel=[0,0,0,0,0,0],this.commandInversion=0,this.channelMidpoint=[0,0,0,0,0,0],this.channelDeadzone=[0,0,0,0,0,0],this.thrustMasterPIDParameters=[0,0,0,0,0,0,0],this.pitchMasterPIDParameters=[0,0,0,0,0,0,0],this.rollMasterPIDParameters=[0,0,0,0,0,0,0],this.yawMasterPIDParameters=[0,0,0,0,0,0,0],this.thrustSlavePIDParameters=[0,0,0,0,0,0,0],this.pitchSlavePIDParameters=[0,0,0,0,0,0,0],this.rollSlavePIDParameters=[0,0,0,0,0,0,0],this.yawSlavePIDParameters=[0,0,0,0,0,0,0],this.thrustGain=0,this.pitchGain=0,this.rollGain=0,this.yawGain=0,this.pidBypass=0,this.stateEstimationParameters=[0,0],this.enableParameters=[0,0],this.ledStates=Array.apply(null,Array(16)).map(function(){return new f}),this.name=""}function T(e,t,r){e.parseFloat32Array(t,r)}function E(e,t){var n=new r;n.parseInt8Array(e,t.version),t.id=e.getUint32(n.index,1),n.add(4),n.parseFloat32Array(e,t.pcbOrientation),n.parseFloat32Array(e,t.pcbTranslation),n.parseInt8Array(e,t.mixTableFz),n.parseInt8Array(e,t.mixTableTx),n.parseInt8Array(e,t.mixTableTy),n.parseInt8Array(e,t.mixTableTz),n.parseFloat32Array(e,t.magBias),n.parseUint8Array(e,t.assignedChannel),t.commandInversion=e.getUint8(n.index),n.add(1),n.parseUint16Array(e,t.channelMidpoint),n.parseUint16Array(e,t.channelDeadzone),T(n,e,t.thrustMasterPIDParameters),T(n,e,t.pitchMasterPIDParameters),T(n,e,t.rollMasterPIDParameters),T(n,e,t.yawMasterPIDParameters),T(n,e,t.thrustSlavePIDParameters),T(n,e,t.pitchSlavePIDParameters),T(n,e,t.rollSlavePIDParameters),T(n,e,t.yawSlavePIDParameters),t.thrustGain=e.getFloat32(n.index,1),n.add(4),t.pitchGain=e.getFloat32(n.index,1),n.add(4),t.rollGain=e.getFloat32(n.index,1),n.add(4),t.yawGain=e.getFloat32(n.index,1),n.add(4),t.pidBypass=e.getUint8(n.index),n.add(1),n.parseFloat32Array(e,t.stateEstimationParameters),n.parseFloat32Array(e,t.enableParameters),t.ledStates.forEach(function(t){c(t,n,e)});var a=new Uint8Array(9);n.parseUint8Array(e,a),t.name=D(a)}function m(e,t){var n=new r,a=e.getUint16(n.index,1);if(n.add(2),a&x.VERSION&&n.parseInt8Array(e,t.version),a&x.ID&&(t.id=e.getUint32(n.index,1),n.add(4)),a&x.PCB&&(n.parseFloat32Array(e,t.pcbOrientation),n.parseFloat32Array(e,t.pcbTranslation)),a&x.MIX_TABLE&&(n.parseInt8Array(e,t.mixTableFz),n.parseInt8Array(e,t.mixTableTx),n.parseInt8Array(e,t.mixTableTy),n.parseInt8Array(e,t.mixTableTz)),a&x.MAG_BIAS&&n.parseFloat32Array(e,t.magBias),a&x.CHANNEL&&(n.parseUint8Array(e,t.assignedChannel),t.commandInversion=e.getUint8(n.index),n.add(1),n.parseUint16Array(e,t.channelMidpoint),n.parseUint16Array(e,t.channelDeadzone)),a&x.PID_PARAMETERS&&(T(n,e,t.thrustMasterPIDParameters),T(n,e,t.pitchMasterPIDParameters),T(n,e,t.rollMasterPIDParameters),T(n,e,t.yawMasterPIDParameters),T(n,e,t.thrustSlavePIDParameters),T(n,e,t.pitchSlavePIDParameters),T(n,e,t.rollSlavePIDParameters),T(n,e,t.yawSlavePIDParameters),t.thrustGain=e.getFloat32(n.index,1),n.add(4),t.pitchGain=e.getFloat32(n.index,1),n.add(4),t.rollGain=e.getFloat32(n.index,1),n.add(4),t.yawGain=e.getFloat32(n.index,1),n.add(4),t.pidBypass=e.getUint8(n.index),n.add(1)),a&x.STATE_PARAMETERS&&(n.parseFloat32Array(e,t.stateEstimationParameters),n.parseFloat32Array(e,t.enableParameters)),a&x.LED_STATES){var i=e.getUint16(n.index,1);n.add(2);for(var s=0;s<16;++s)i&1<<s&&c(t.ledStates[s],n,e)}if(a&x.DEVICE_NAME){var o=new Uint8Array(9);n.parseUint8Array(e,o),t.name=D(o)}}function S(e,t){var n=new r;n.setInt8Array(e,t.version),e.setUint32(n.index,t.id,1),n.add(4),n.setFloat32Array(e,t.pcbOrientation),n.setFloat32Array(e,t.pcbTranslation),n.setInt8Array(e,t.mixTableFz),n.setInt8Array(e,t.mixTableTx),n.setInt8Array(e,t.mixTableTy),n.setInt8Array(e,t.mixTableTz),n.setFloat32Array(e,t.magBias),n.setUint8Array(e,t.assignedChannel),e.setUint8(n.index,t.commandInversion),n.add(1),n.setUint16Array(e,t.channelMidpoint),n.setUint16Array(e,t.channelDeadzone),n.setFloat32Array(e,t.thrustMasterPIDParameters),n.setFloat32Array(e,t.pitchMasterPIDParameters),n.setFloat32Array(e,t.rollMasterPIDParameters),n.setFloat32Array(e,t.yawMasterPIDParameters),n.setFloat32Array(e,t.thrustSlavePIDParameters),n.setFloat32Array(e,t.pitchSlavePIDParameters),n.setFloat32Array(e,t.rollSlavePIDParameters),n.setFloat32Array(e,t.yawSlavePIDParameters),e.setFloat32(n.index,t.thrustGain,1),n.add(4),e.setFloat32(n.index,t.pitchGain,1),n.add(4),e.setFloat32(n.index,t.rollGain,1),n.add(4),e.setFloat32(n.index,t.yawGain,1),n.add(4),e.setUint8(n.index,t.pidBypass),n.add(1),n.setFloat32Array(e,t.stateEstimationParameters),n.setFloat32Array(e,t.enableParameters),t.ledStates.forEach(function(t){A(t,n,e)}),n.setUint8Array(e,v(t.name,9))}function h(e,t,n,a){var i=new r;if(e.setUint16(i.index,n,1),i.add(2),n&x.VERSION&&i.setInt8Array(e,t.version),n&x.ID&&(e.setUint32(i.index,t.id,1),i.add(4)),n&x.PCB&&(i.setFloat32Array(e,t.pcbOrientation),i.setFloat32Array(e,t.pcbTranslation)),n&x.MIX_TABLE&&(i.setInt8Array(e,t.mixTableFz),i.setInt8Array(e,t.mixTableTx),i.setInt8Array(e,t.mixTableTy),i.setInt8Array(e,t.mixTableTz)),n&x.MAG_BIAS&&i.setFloat32Array(e,t.magBias),n&x.CHANNEL&&(i.setUint8Array(e,t.assignedChannel),e.setUint8(i.index,t.commandInversion),i.add(1),i.setUint16Array(e,t.channelMidpoint),i.setUint16Array(e,t.channelDeadzone)),n&x.PID_PARAMETERS&&(i.setFloat32Array(e,t.thrustMasterPIDParameters),i.setFloat32Array(e,t.pitchMasterPIDParameters),i.setFloat32Array(e,t.rollMasterPIDParameters),i.setFloat32Array(e,t.yawMasterPIDParameters),i.setFloat32Array(e,t.thrustSlavePIDParameters),i.setFloat32Array(e,t.pitchSlavePIDParameters),i.setFloat32Array(e,t.rollSlavePIDParameters),i.setFloat32Array(e,t.yawSlavePIDParameters),e.setFloat32(i.index,t.thrustGain,1),i.add(4),e.setFloat32(i.index,t.pitchGain,1),i.add(4),e.setFloat32(i.index,t.rollGain,1),i.add(4),e.setFloat32(i.index,t.yawGain,1),i.add(4),e.setUint8(i.index,t.pidBypass),i.add(1)),n&x.STATE_PARAMETERS&&(i.setFloat32Array(e,t.stateEstimationParameters),i.setFloat32Array(e,t.enableParameters)),n&x.LED_STATES){e.setUint16(i.index,a,1),i.add(2);for(var s=0;s<16;++s)a&1<<s&&A(t.ledStates[s],i,e)}return n&x.DEVICE_NAME&&i.setUint8Array(e,v(t.name,9)),i.index}function y(e){t("Received config!");var r=new DataView(e,0);M=new u,E(r,M),g()}function p(e){t("Received partial config!");var r=new DataView(e,0);M=angular.copy(M),m(r,M),g()}function g(){b[0]!==M.version[0]||b[1]!==M.version[1]?(t('<span style="color: red">WARNING: Configuration MAJOR or MINOR version mismatch!</span>'),t("eeprom version: <strong>"+M.version[0]+"."+M.version[1]+"."+M.version[2]+"</strong> - app expected version: <strong>"+b[0]+"."+b[1]+"."+b[2]+"</strong>")):(t('Recieved configuration version: <span style="color: green">'+M.version[0]+"."+M.version[1]+"."+M.version[2]+"</span>"),C())}function I(e){C=e}function P(e){U=e}function R(){return M}function v(e,t){var r=new Uint8Array(t);return e.split("").forEach(function(e,t){r[t]=e.charCodeAt(0)}),r[t-1]=0,r}function D(e){for(var t="",r=0;r<e.length&&r<8;++r){if(0===e[r])return t;t+=String.fromCharCode(e[r])}return t}var M,O=652,b=[1,5,0],C=function(){t("No callback defined for receiving configurations!")},U=function(){t("No callback defined for receiving logging state! Callback arguments: (isLogging, isLocked, delay)")},x={VERSION:1,ID:2,PCB:4,MIX_TABLE:8,MAG_BIAS:16,CHANNEL:32,PID_PARAMETERS:64,STATE_PARAMETERS:128,LED_STATES:256,DEVICE_NAME:512};return e.setCommandCallback(function(r,n){if(r&e.field.COM_SET_EEPROM_DATA&&y(n),r&e.field.COM_SET_PARTIAL_EEPROM_DATA&&p(n),r&(e.field.COM_SET_CARD_RECORDING|e.field.COM_SET_SD_WRITE_DELAY)){var a=new Uint8Array(n);if(a.length>=3){var i=a[0]|a[1]<<8,s=a[2];U(0!==(1&s),0!==(2&s),i)}else t("Bad data given for logging info")}}),M=new u,{request:a,reinit:i,send:s,sendPartial:o,getConfig:R,setConfigCallback:I,setLoggingCallback:P,getDesiredVersion:n,field:x}}angular.module("flybrixCommon").factory("deviceConfig",e),e.$inject=["serial","commandLog","serializer"]}(),function(){"use strict";function e(e){function t(e,t,r,a,d,_,l){d>0&&d<6&&(o.pattern=d),[e,t,r,a].forEach(function(e,t){if(e){var r=s[i[t]];r.red=e.red,r.green=e.green,r.blue=e.blue}}),void 0!==_&&(o.indicator_red=_),void 0!==l&&(o.indicator_green=l),n()}function r(e,r,n){var i={red:e||0,green:r||0,blue:n||0};t(i,i,i,i,a.SOLID)}function n(){e.sendPartial(e.field.LED_STATES,1,d,!0)}var a={NO_OVERRIDE:0,FLASH:1,BEACON:2,BREATHE:3,ALTERNATE:4,SOLID:5},i=["right_front","right_back","left_front","left_back"],s={};i.forEach(function(e){s[e]={red:0,green:0,blue:0}});var o={status:65535,pattern:a.SOLID,colors:s,indicator_red:!1,indicator_green:!1},d={ledStates:[o]};return{set:t,setSimple:r,patterns:a}}angular.module("flybrixCommon").factory("led",e),e.$inject=["deviceConfig"]}(),function(){"use strict";function e(e,t){function r(){if(R||!e.busy()){R=!1;var r=new t,n=new ArrayBuffer(10),a=new DataView(n,0);a.setUint8(r.index,1),r.add(1);var i=-.8,s=E(4095*(h-i)/(1-i),0,4095),o=E(4095*-m(y,.1)/2,-2047,2047),d=E(4095*m(p,.1)/2,-2047,2047),_=E(4095*-m(g,.1)/2,-2047,2047),l=[s,o,d,_];r.setInt16Array(a,l);var f=(1<<I)+(1<<P+3);return a.setUint8(r.index,f),e.send(e.field.COM_SET_SERIAL_RC,new Uint8Array(n),!1)}}function n(e){h=e}function a(e){y=e}function i(e){p=e}function s(e){g=e}function o(e){I=e}function d(e){P=e}function _(){return h}function l(){return y}function f(){return p}function c(){return g}function A(){return I}function u(){return P}function T(){R=!0}function E(e,t,r){return Math.max(t,Math.min(e,r))}function m(e,t){return e>t?e-t:e<-t?e+t:0}var S={LOW:0,MID:1,HIGH:2},h=-1,y=0,p=0,g=0,I=S.HIGH,P=S.HIGH,R=!0;return{setThrottle:n,setPitch:a,setRoll:i,setYaw:s,setAux1:o,setAux2:d,getThrottle:_,getPitch:l,getRoll:f,getYaw:c,getAux1:A,getAux2:u,AUX:S,send:r,forceNextSend:T}}angular.module("flybrixCommon").factory("rcData",e),e.$inject=["serial","serializer"]}();