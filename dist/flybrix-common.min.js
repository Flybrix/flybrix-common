!function(){"use strict";angular.module("flybrixCommon",[])}(),function(){"use strict";function e(){return 0}function n(e){var n=c["Uint"+e];if(void 0===n)throw new Error("Unsupported split bit count: "+e+". Allowed counts: 8, 16, 32, 64");return n}function t(e){function n(n,t,a){l.encode(n,t,r(a,e))}function t(n,t){return a(l.decode(n,t),e)}function o(){return""}var l=i(e,c.Uint8);return new f(n,t,o)}function r(e,n){var t=new Uint8Array(n);return e.split("").forEach(function(e,n){t[n]=e.charCodeAt(0)}),t[n-1]=0,t}function a(e,n){for(var t="",r=Math.min(e.length,n-1),a=0;a<r;++a){if(0===e[a])return t;t+=String.fromCharCode(e[a])}return t}function i(e,t,r){function a(n,r,a){for(var i=0;i<e;++i)t.encode(n,r,a[i])}function i(n,r){for(var a=[],i=0;i<e;++i)a.push(t.decode(n,r));return a}function o(){for(var n=[],r=0;r<e;++r)n.push(t.empty());return n}function c(n,r,a,i){var o=i.pop();s.encode(n,r,o);for(var f=0;f<e;++f)o&1<<f&&t.encodePartial(n,r,a[f],i)}function l(n,r,a){for(var i=s.decode(n,r),o=[],f=0;f<e;++f)i&1<<f?o.push(t.decodePartial(n,r,a[f])):o.push(a[f]);return o}function c(n,r,a,i){for(var o=0;o<e;++o)t.encodePartial(n,r,a[o],i)}function l(n,r,a){for(var i=[],o=0;o<e;++o)i.push(t.decodePartial(n,r,a[o]));return i}if(void 0===e)throw new Error("Array type requires length");if(!(t instanceof f))throw new Error("Array type requires Handler type as element");var u;if(void 0!==r){var s=n(r);u=new f(a,i,o,c,l)}else u=new f(a,i,o,c,l);return u.children={element:t,count:e},u}function o(e,t){function r(n,t,r){e.forEach(function(e){e.element.encode(n,t,r[e.key])})}function a(n,t){var r={};return e.forEach(function(e){r[e.key]=e.element.decode(n,t)}),r}function i(){var n={};return e.forEach(function(e){n[e.key]=e.element.empty()}),n}function o(n,t,r,a){var i=a.pop();s.encode(n,t,i),e.forEach(function(e){i&1<<e.part&&e.element.encodePartial(n,t,r[e.key],a)})}function c(n,t,r){var a=s.decode(n,t),i={};return e.forEach(function(e){a&1<<e.part?i[e.key]=e.element.decodePartial(n,t,r[e.key]):i[e.key]=r[e.key]}),i}function o(n,t,r,a){e.forEach(function(e){e.element.encodePartial(n,t,r[e.key],a)})}function c(n,t,r){var a={};return e.forEach(function(e){a[e.key]=e.element.decodePartial(n,t,r[e.key])}),a}var l=e.length;if(void 0===l)throw new Error("Map type requires an array of {key: String, element: Handler} maps");e.forEach(function(e){if(void 0===e.key||!(e.element instanceof f))throw new Error("Map type requires an array of {key: String, element: Handler} maps")});var u;if(void 0!==t){var s=n(t);u=new f(r,a,i,o,c)}else u=new f(r,a,i,o,c);return u.children=e,u}function f(e,n,t,r,a){r=r||e,a=a||n,this.encode=e,this.decode=n,this.encodePartial=r,this.decodePartial=a,this.empty=t}angular.module("flybrixCommon").factory("encodable",function(){return c});var c={string:t,map:o,array:i,Handler:f};["Uint","Int"].forEach(function(n){[1,2,4].forEach(function(t){function r(e,n,r){e["set"+i](n.index,r,1),n.add(t)}function a(e,n){var r=e["get"+i](n.index,1);return n.add(t),r}var i=n+8*t;c[i]=new f(r,a,e)})}),[4,8].forEach(function(n){function t(e,t,r){e["set"+a](t.index,r,1),t.add(n)}function r(e,t){var r=e["get"+a](t.index,1);return t.add(n),r}var a="Float"+8*n;c[a]=new f(t,r,e)}),c.bool=new f(function(e,n,t){c.Uint8.encode(e,n,t?1:0)},function(e,n){return 0!==c.Uint8.decode(e,n)},function(){return!1})}(),function(){"use strict";function e(){return{Reader:n,encode:r}}function n(e){void 0===e&&(e=2e3),this.N=e,this.buffer=new Uint8Array(e),this.ready_for_new_message=!0,this.buffer_length=0}function t(e){for(var n=0,t=0,r=0,a=!1;e.buffer[n];)r?(--r,e.buffer[t++]=e.buffer[n++]):(a&&(e.buffer[t++]=0),r=e.buffer[n++]-1,a=r<254);return r?0:t}function r(e){for(var n=new Uint8Array(Math.floor((255*e.byteLength+761)/254)),t=1,r=0,a=0;a<e.length;++a){254==n[r]&&(n[r]=255,r=t++,n[r]=0);var i=e[a];++n[r],i?n[t++]=i:(r=t++,n[r]=0)}return n.subarray(0,t).slice().buffer}angular.module("flybrixCommon").factory("cobs",e),n.prototype.AppendToBuffer=function(e,n,r){for(var a=0;a<e.length;a++){var i=e[a];if(this.ready_for_new_message&&(this.ready_for_new_message=!1,this.buffer_length=0),this.buffer[this.buffer_length++]=i,i&&this.buffer_length==this.N)r("overflow","buffer overflow in COBS decoding"),this.ready_for_new_message=!0;else if(!i){this.buffer_length=t(this);var o=0===this.buffer_length;o&&(this.buffer[0]=1);for(var f=1;f<this.buffer_length;++f)this.buffer[0]^=this.buffer[f];if(0===this.buffer[0])if(this.ready_for_new_message=!0,this.buffer_length>5){for(var c=this.buffer[1],l=0,u=0;u<4;++u)l|=this.buffer[u+2]<<8*u;n(c,l,this.buffer.subarray(6,this.buffer_length).slice().buffer)}else r("short","Too short packet");else{this.ready_for_new_message=!0;for(var s="",_="",f=0;f<this.buffer_length;f++)s+=this.buffer[f]+",",_+=String.fromCharCode(this.buffer[f]);if(o)r("frame","Unexpected ending of packet");else{var d="BAD CHECKSUM ("+this.buffer_length+" bytes)"+s+_;r("checksum",d)}}}}}}(),function(){"use strict";function e(e){function n(e){void 0!==e&&(i.push(e),o.notify(t()))}function t(){return i}function r(){o=e.defer()}function a(e){return o.promise.then(void 0,void 0,e)}var i=[],o=e.defer(),f=n;return f.log=n,f.clearSubscribers=r,f.onMessage=a,f.read=t,f}angular.module("flybrixCommon").factory("commandLog",e),e.$inject=["$q"]}(),function(){"use strict";function e(){return n}function n(){this.index=0}angular.module("flybrixCommon").factory("serializer",e),n.prototype.add=function(e){this.index+=e},[["Float32",4],["Int16",2],["Int8",1],["Uint8",1],["Uint16",2]].forEach(function(e){var t=e[0],r=e[1],a="get"+t,i="set"+t;n.prototype["parse"+t+"Array"]=function(e,n){for(var t=0;t<n.length;t++)n[t]=e[a](this.index,1),this.add(r)},n.prototype["set"+t+"Array"]=function(e,n){for(var t=0;t<n.length;t++)e[i](this.index,n[t],1),this.add(r)}})}(),function(){"use strict";function e(e,n,t){function r(e,n,t,r,i,f){a(e,n,t,function(){o(n,t,r)},i,f)}function a(n,t,r,a,o,c){switch(n){case f.State:a(t,r);break;case f.Command:o(t,r);break;case f.DebugString:var l=i(r);e('Received <span style="color: orange">DEBUG</span>: '+l);break;case f.HistoryData:var l=i(r);e('Received <span style="color: orange">HISTORY DATA</span>');break;case f.Response:var u=new DataView(r,0);c(t,u.getInt32(0,1))}}function i(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function o(e,t,r){var a=_.empty(),i=[],o=new DataView(t,0),f=new n,c=0;_.children.forEach(function(n,t){var r=1<<t;if(e&r){i[t]=!0;var c=n.element,l=n.key;a[l]=c.decode(o,f)}}),e&l.STATE_MICROS&&(c=1e6/(a.timestamp_us-s),s=a.timestamp_us),e&l.STATE_TEMPERATURE&&(a.temperature/=100),e&l.STATE_PRESSURE&&(a.pressure/=256),r(a,i,c)}var f={State:0,Command:1,DebugString:3,HistoryData:4,Response:255},c={COM_REQ_RESPONSE:1,COM_SET_EEPROM_DATA:2,COM_REINIT_EEPROM_DATA:4,COM_REQ_EEPROM_DATA:8,COM_REQ_ENABLE_ITERATION:16,COM_MOTOR_OVERRIDE_SPEED_0:32,COM_MOTOR_OVERRIDE_SPEED_1:64,COM_MOTOR_OVERRIDE_SPEED_2:128,COM_MOTOR_OVERRIDE_SPEED_3:256,COM_MOTOR_OVERRIDE_SPEED_4:512,COM_MOTOR_OVERRIDE_SPEED_5:1024,COM_MOTOR_OVERRIDE_SPEED_6:2048,COM_MOTOR_OVERRIDE_SPEED_7:4096,COM_MOTOR_OVERRIDE_SPEED_ALL:8160,COM_SET_COMMAND_OVERRIDE:8192,COM_SET_STATE_MASK:16384,COM_SET_STATE_DELAY:32768,COM_SET_SD_WRITE_DELAY:65536,COM_SET_LED:1<<17,COM_SET_SERIAL_RC:1<<18,COM_SET_CARD_RECORDING:1<<19,COM_SET_PARTIAL_EEPROM_DATA:1<<20,COM_REINIT_PARTIAL_EEPROM_DATA:1<<21,COM_REQ_PARTIAL_EEPROM_DATA:1<<22,COM_REQ_CARD_RECORDING_STATE:1<<23,COM_SET_PARTIAL_TEMPORARY_CONFIG:1<<24},l={STATE_ALL:4294967295,STATE_NONE:0,STATE_MICROS:1,STATE_STATUS:2,STATE_V0:4,STATE_I0:8,STATE_I1:16,STATE_ACCEL:32,STATE_GYRO:64,STATE_MAG:128,STATE_TEMPERATURE:256,STATE_PRESSURE:512,STATE_RX_PPM:1024,STATE_AUX_CHAN_MASK:2048,STATE_COMMANDS:4096,STATE_F_AND_T:8192,STATE_PID_FZ_MASTER:32768,STATE_PID_TX_MASTER:65536,STATE_PID_TY_MASTER:1<<17,STATE_PID_TZ_MASTER:1<<18,STATE_PID_FZ_SLAVE:1<<19,STATE_PID_TX_SLAVE:1<<20,STATE_PID_TY_SLAVE:1<<21,STATE_PID_TZ_SLAVE:1<<22,STATE_MOTOR_OUT:1<<23,STATE_KINE_ANGLE:1<<24,STATE_KINE_RATE:1<<25,STATE_KINE_ALTITUDE:1<<26,STATE_LOOP_COUNT:1<<27},u={STATUS_BOOT:1,STATUS_MPU_FAIL:2,STATUS_BMP_FAIL:4,STATUS_RX_FAIL:8,STATUS_IDLE:16,STATUS_ENABLING:32,STATUS_CLEAR_MPU_BIAS:64,STATUS_SET_MPU_BIAS:128,STATUS_FAIL_STABILITY:256,STATUS_FAIL_ANGLE:512,STATUS_ENABLED:1024,STATUS_BATTERY_LOW:2048,STATUS_TEMP_WARNING:4096,STATUS_LOG_FULL:8192,STATUS_UNPAIRED:16384,STATUS_OVERRIDE:32768},s=0,_=function(){var e=t,n=e.map([{key:"time",element:e.Uint32},{key:"values",element:e.array(5,e.Float32)}]),r=new e.Handler(function(e,t,r){n.encode(e,t,{time:r[0],values:r.slice(1)})},function(e,t){var r=n.decode(e,t);return[r.time].concat(r.values)},function(){return[0,0,0,0,0,0]});return e.map([{key:"timestamp_us",element:e.Uint32},{key:"status",element:e.Uint16},{key:"V0_raw",element:e.Uint16},{key:"I0_raw",element:e.Uint16},{key:"I1_raw",element:e.Uint16},{key:"accel",element:e.array(3,e.Float32)},{key:"gyro",element:e.array(3,e.Float32)},{key:"mag",element:e.array(3,e.Float32)},{key:"temperature",element:e.Uint16},{key:"pressure",element:e.Uint32},{key:"ppm",element:e.array(6,e.Int16)},{key:"AUX_chan_mask",element:e.Uint8},{key:"command",element:e.array(4,e.Int16)},{key:"control",element:e.array(4,e.Float32)},{key:"UNUSED",element:e.map([])},{key:"pid_master_Fz",element:r},{key:"pid_master_Tx",element:r},{key:"pid_master_Ty",element:r},{key:"pid_master_Tz",element:r},{key:"pid_slave_Fz",element:r},{key:"pid_slave_Tx",element:r},{key:"pid_slave_Ty",element:r},{key:"pid_slave_Tz",element:r},{key:"MotorOut",element:e.array(8,e.Int16)},{key:"kinematicsAngle",element:e.array(3,e.Float32)},{key:"kinematicsRate",element:e.array(3,e.Float32)},{key:"kinematicsAltitude",element:e.Float32},{key:"loopCount",element:e.Uint32}])}();return{processBinaryDatastream:r,MessageType:f,CommandFields:c,StatusCodes:u}}angular.module("flybrixCommon").factory("parser",e),e.$inject=["commandLog","serializer","encodable"]}(),function(){"use strict";function e(e,n,t,r,a){function i(){}function o(e){A=e,A.onRead=u}function f(i,o,f){void 0===f&&(f=!0);var c=n.defer();i|=a.CommandFields.COM_REQ_RESPONSE;var l,u,s=0;if("object"==typeof o){var _=7+o.length;u=new Uint8Array(_),s^=u[1]=a.MessageType.Command;for(var d=0;d<4;++d)s^=u[d+2]=T(i,d);for(var d=0;d<o.length;d++)s^=u[d+6]=o[d]}else{l=new ArrayBuffer(8),u=new Uint8Array(l),s^=u[1]=a.MessageType.Command;for(var d=0;d<4;++d)s^=u[d+2]=T(i,d);s^=u[6]=o}return u[0]=s,u[u.length-1]=0,y.push({mask:i,response:c}),e(function(){A.send(new Uint8Array(t.encode(u)))},0),f&&r('Sending command <span style="color:blue">'+a.MessageType.Command+"</blue>"),c.promise}function c(){return A.busy()}function l(e){h=e}function u(e){h?h(e,E):R.AppendToBuffer(e,E,s)}function s(e,n){r("COBS decoding failed ("+e+"): "+n)}function _(e){S=e}function d(e){p=e}function m(e,n){for(;y.length>0;){var t=y.shift();{if(t.mask===e){var r=e;if(r&=~a.CommandFields.COM_REQ_RESPONSE,r!==n){t.response.reject("Request was not fully processed");break}t.response.resolve();break}t.response.reject("Missing ACK")}}}function E(e,n,t){a.processBinaryDatastream(e,n,t,S,p,m)}function T(e,n){return e>>8*n&255}var y=[],A=new i,S=function(){r("No state listener defined for serial")},p=function(){r("No command listener defined for serial")},R=new t.Reader(2e3),h=void 0;return i.prototype.busy=function(){return!1},i.prototype.send=function(e){r('No "send" defined for serial backend')},i.prototype.onRead=function(e){r('No "onRead" defined for serial backend')},{busy:c,field:a.CommandFields,send:f,setBackend:o,setStateCallback:_,setCommandCallback:d,setDataHandler:l,Backend:i}}angular.module("flybrixCommon").factory("serial",e),e.$inject=["$timeout","$q","cobs","commandLog","parser"]}(),function(){"use strict";function e(e,n,t,r){function a(){return S}function i(){n("Requesting current configuration data..."),e.send(e.field.COM_REQ_EEPROM_DATA,[],!1)}function o(){n("Setting factory default configuration data..."),e.send(e.field.COM_REINIT_EEPROM_DATA,[],!1).then(function(){i()},function(e){n("Request for factory reset failed: "+e)})}function f(t){void 0===t&&(t=y),n("Sending new configuration data...");var r=new ArrayBuffer(A),a=new DataView(r,0);l(a,t);var o=new Uint8Array(r);e.send(e.field.COM_SET_EEPROM_DATA,o,!1).then(function(){i()})}function c(n,t,r,a,o){void 0===n&&(n=0),void 0===t&&(t=0),void 0===r&&(r=y);var f=a?e.field.COM_SET_PARTIAL_TEMPORARY_CONFIG:e.field.COM_SET_PARTIAL_EEPROM_DATA,c=new ArrayBuffer(A),l=new DataView(c,0),s=u(l,r,n,t),_=new Uint8Array(c.slice(0,s));e.send(f,_,!1).then(function(){o&&i()})}function l(e,n){g.encode(e,new t,n)}function u(e,n,r,a){var i=new t;return g.encodePartial(e,i,n,[a,r]),i.index}function s(e){n("Received config!"),y=g.decode(new DataView(e,0),new t),d()}function _(e){n("Received partial config!"),y=g.decodePartial(new DataView(e,0),new t,angular.copy(y)),d()}function d(){S[0]!==y.version[0]||S[1]!==y.version[1]?(n('<span style="color: red">WARNING: Configuration MAJOR or MINOR version mismatch!</span>'),n("eeprom version: <strong>"+y.version[0]+"."+y.version[1]+"."+y.version[2]+"</strong> - app expected version: <strong>"+S[0]+"."+S[1]+"."+S[2]+"</strong>")):(n('Recieved configuration version: <span style="color: green">'+y.version[0]+"."+y.version[1]+"."+y.version[2]+"</span>"),p())}function m(e){p=e}function E(e){R=e}function T(){return y}var y,A=652,S=[1,5,0],p=function(){n("No callback defined for receiving configurations!")},R=function(){n("No callback defined for receiving logging state! Callback arguments: (isLogging, isLocked, delay)")},h={VERSION:1,ID:2,PCB:4,MIX_TABLE:8,MAG_BIAS:16,CHANNEL:32,PID_PARAMETERS:64,STATE_PARAMETERS:128,LED_STATES:256,DEVICE_NAME:512};e.setCommandCallback(function(t,r){if(t&e.field.COM_SET_EEPROM_DATA&&s(r),t&e.field.COM_SET_PARTIAL_EEPROM_DATA&&_(r),t&(e.field.COM_SET_CARD_RECORDING|e.field.COM_SET_SD_WRITE_DELAY)){var a=new Uint8Array(r);if(a.length>=3){var i=a[0]|a[1]<<8,o=a[2];R(0!==(1&o),0!==(2&o),i)}else n("Bad data given for logging info")}});var g=function(){var e=r,n=e.map([{key:"red",element:e.Uint8},{key:"green",element:e.Uint8},{key:"blue",element:e.Uint8}]),t=e.map([{key:"status",element:e.Uint16},{key:"pattern",element:e.Uint8},{key:"colors",element:e.map([{key:"right_front",element:n},{key:"right_back",element:n},{key:"left_front",element:n},{key:"left_back",element:n}])},{key:"indicator_red",element:e.bool},{key:"indicator_green",element:e.bool}]),a=e.array(3,e.Float32),i=(e.array(3,e.Uint8),e.array(6,e.Uint8)),o=e.array(6,e.Uint16),f=e.array(7,e.Float32),c=e.array(2,e.Float32),l=e.array(16,t,16);e.string(9);return e.map([{part:0,key:"version",element:e.array(3,e.Uint8)},{part:1,key:"id",element:e.Uint32},{part:2,key:"pcbOrientation",element:a},{part:2,key:"pcbTranslation",element:a},{part:3,key:"mixTableFz",element:e.array(8,e.Uint8)},{part:3,key:"mixTableTx",element:e.array(8,e.Uint8)},{part:3,key:"mixTableTy",element:e.array(8,e.Uint8)},{part:3,key:"mixTableTz",element:e.array(8,e.Uint8)},{part:4,key:"magBias",element:a},{part:5,key:"assignedChannel",element:i},{part:5,key:"commandInversion",element:e.Uint8},{part:5,key:"channelMidpoint",element:o},{part:5,key:"channelDeadzone",element:o},{part:6,key:"thrustMasterPIDParameters",element:f},{part:6,key:"pitchMasterPIDParameters",element:f},{part:6,key:"rollMasterPIDParameters",element:f},{part:6,key:"yawMasterPIDParameters",element:f},{part:6,key:"thrustSlavePIDParameters",element:f},{part:6,key:"pitchSlavePIDParameters",element:f},{part:6,key:"rollSlavePIDParameters",element:f},{part:6,key:"yawSlavePIDParameters",element:f},{part:6,key:"thrustGain",element:e.Float32},{part:6,key:"pitchGain",element:e.Float32},{part:6,key:"rollGain",element:e.Float32},{part:6,key:"yawGain",element:e.Float32},{part:6,key:"pidBypass",element:e.Uint8},{part:7,key:"stateEstimationParameters",element:c},{part:7,key:"enableParameters",element:c},{part:8,key:"ledStates",element:l},{part:9,key:"name",element:e.string(9)}],16)}();return y=g.empty(),{request:i,reinit:o,send:f,sendPartial:c,getConfig:T,setConfigCallback:m,setLoggingCallback:E,getDesiredVersion:a,field:h}}angular.module("flybrixCommon").factory("deviceConfig",e),e.$inject=["serial","commandLog","serializer","encodable"]}(),function(){"use strict";function e(e){function n(e,n,t,a,c,l,u){c>0&&c<6&&(f.pattern=c),[e,n,t,a].forEach(function(e,n){if(e){var t=o[i[n]];t.red=e.red,t.green=e.green,t.blue=e.blue}}),void 0!==l&&(f.indicator_red=l),void 0!==u&&(f.indicator_green=u),r()}function t(e,t,r){var i={red:e||0,green:t||0,blue:r||0};n(i,i,i,i,a.SOLID)}function r(){e.sendPartial(e.field.LED_STATES,1,c,!0)}var a={NO_OVERRIDE:0,FLASH:1,BEACON:2,BREATHE:3,ALTERNATE:4,SOLID:5},i=["right_front","right_back","left_front","left_back"],o={};i.forEach(function(e){o[e]={red:0,green:0,blue:0}});var f={status:65535,pattern:a.SOLID,colors:o,indicator_red:!1,indicator_green:!1},c={ledStates:[f]};return{set:n,setSimple:t,patterns:a}}angular.module("flybrixCommon").factory("led",e),e.$inject=["deviceConfig"]}(),function(){"use strict";function e(e,n,t){function r(){if(O||!e.busy()){O=!1;var t={enabled:!0},r={},a=-.8;r.throttle=y(4095*(p-a)/(1-a),0,4095),r.pitch=y(4095*-A(R,.1)/2,-2047,2047),r.roll=y(4095*A(h,.1)/2,-2047,2047),r.yaw=y(4095*-A(g,.1)/2,-2047,2047),t.command=r,t.auxcode=(1<<v)+(1<<k+3);var i=new Uint8Array(10);return C.encode(new DataView(i.buffer),new n,t),e.send(e.field.COM_SET_SERIAL_RC,i,!1)}}function a(e){p=e}function i(e){R=e}function o(e){h=e}function f(e){g=e}function c(e){v=e}function l(e){k=e}function u(){return p}function s(){return R}function _(){return h}function d(){return g}function m(){return v}function E(){return k}function T(){O=!0}function y(e,n,t){return Math.max(n,Math.min(e,t))}function A(e,n){return e>n?e-n:e<-n?e+n:0}var S={LOW:0,MID:1,HIGH:2},p=-1,R=0,h=0,g=0,v=S.HIGH,k=S.HIGH,O=!0,M=t.map([{key:"throttle",element:t.Int16},{key:"pitch",element:t.Int16},{key:"roll",element:t.Int16},{key:"yaw",element:t.Int16}]),C=t.map([{key:"enabled",element:t.bool},{key:"command",element:M},{key:"auxcode",element:t.Uint8}]);return{setThrottle:a,setPitch:i,setRoll:o,setYaw:f,setAux1:c,setAux2:l,getThrottle:u,getPitch:s,getRoll:_,getYaw:d,getAux1:m,getAux2:E,AUX:S,send:r,forceNextSend:T}}angular.module("flybrixCommon").factory("rcData",e),e.$inject=["serial","serializer","encodable"]}();