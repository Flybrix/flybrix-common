!function(){"use strict";angular.module("flybrixCommon",[])}(),function(){"use strict";function e(){return{Reader:t,encode:r}}function t(e){void 0===e&&(e=2e3),this.N=e,this.buffer=new Uint8Array(e),this.ready_for_new_message=!0,this.buffer_length=0}function a(e){for(var t=0,a=0,r=0,n=!1;e.buffer[t];)r?(--r,e.buffer[a++]=e.buffer[t++]):(n&&(e.buffer[a++]=0),r=e.buffer[t++]-1,n=r<254);return r?0:a}function r(e){for(var t=new Uint8Array(Math.floor((255*e.byteLength+761)/254)),a=1,r=0,n=0;n<e.length;++n){254==t[r]&&(t[r]=255,r=a++,t[r]=0);var i=e[n];++t[r],i?t[a++]=i:(r=a++,t[r]=0)}return t.subarray(0,a).slice().buffer}angular.module("flybrixCommon").factory("cobs",e),t.prototype.AppendToBuffer=function(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];if(this.ready_for_new_message&&(this.ready_for_new_message=!1,this.buffer_length=0),this.buffer[this.buffer_length++]=i,i&&this.buffer_length==this.N)r("overflow","buffer overflow in COBS decoding"),this.ready_for_new_message=!0;else if(!i){this.buffer_length=a(this);var s=0===this.buffer_length;s&&(this.buffer[0]=1);for(var o=1;o<this.buffer_length;++o)this.buffer[0]^=this.buffer[o];if(0===this.buffer[0])if(this.ready_for_new_message=!0,this.buffer_length>5){for(var d=this.buffer[1],_=0,l=0;l<4;++l)_|=this.buffer[l+2]<<8*l;t(d,_,this.buffer.subarray(6,this.buffer_length).slice().buffer)}else r("short","Too short packet");else{this.ready_for_new_message=!0;for(var A="",T="",o=0;o<this.buffer_length;o++)A+=this.buffer[o]+",",T+=String.fromCharCode(this.buffer[o]);if(s)r("frame","Unexpected ending of packet");else{var f="BAD CHECKSUM ("+this.buffer_length+" bytes)"+A+T;r("checksum",f)}}}}}}(),function(){"use strict";function e(e){function t(e){void 0!==e&&(i.push(e),s.notify(a()))}function a(){return i}function r(){s=e.defer()}function n(e){return s.promise.then(void 0,void 0,e)}var i=[],s=e.defer(),o=t;return o.log=t,o.clearSubscribers=r,o.onMessage=n,o.read=a,o}angular.module("flybrixCommon").factory("commandLog",e),e.$inject=["$q"]}(),function(){"use strict";function e(){return t}function t(){this.index=0}angular.module("flybrixCommon").factory("serializer",e),t.prototype.add=function(e){this.index+=e},[["Float32",4],["Int16",2],["Int8",1],["Uint8",1],["Uint16",2]].forEach(function(e){var a=e[0],r=e[1],n="get"+a,i="set"+a;t.prototype["parse"+a+"Array"]=function(e,t){for(var a=0;a<t.length;a++)t[a]=e[n](this.index,1),this.add(r)},t.prototype["set"+a+"Array"]=function(e,t){for(var a=0;a<t.length;a++)e[i](this.index,t[a],1),this.add(r)}})}(),function(){"use strict";function e(e,t){function a(){this.timestamp_us=0,this.status=0,this.V0_raw=0,this.I0_raw=0,this.I1_raw=0,this.accel=[0,0,0],this.gyro=[0,0,0],this.mag=[0,0,0],this.temperature=0,this.pressure=0,this.ppm=[0,0,0,0,0,0],this.AUX_chan_mask=0,this.command=[0,0,0,0],this.control=[0,0,0,0],this.pid_master_Fz=[0,0,0,0,0,0],this.pid_master_Tx=[0,0,0,0,0,0],this.pid_master_Ty=[0,0,0,0,0,0],this.pid_master_Tz=[0,0,0,0,0,0],this.pid_slave_Fz=[0,0,0,0,0,0],this.pid_slave_Tx=[0,0,0,0,0,0],this.pid_slave_Ty=[0,0,0,0,0,0],this.pid_slave_Tz=[0,0,0,0,0,0],this.MotorOut=[0,0,0,0,0,0,0,0],this.kinematicsAngle=[0,0,0],this.kinematicsRate=[0,0,0],this.kinematicsAltitude=0,this.loopCount=0}function r(e,t,a,r,i,s){n(e,t,a,function(){o(t,a,r)},i,s)}function n(t,a,r,n,s,o){switch(t){case d.State:n(a,r);break;case d.Command:s(a,r);break;case d.DebugString:var _=i(r);e('Received <span style="color: orange">DEBUG</span>: '+_);break;case d.HistoryData:var _=i(r);e('Received <span style="color: orange">HISTORY DATA</span>');break;case d.Response:var l=new DataView(r,0);o(a,l.getInt32(0,1))}}function i(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function s(e,t,a){t[0]=e.getUint32(a.index,1),a.add(4);for(var r=1;r<6;r++)t[r]=e.getFloat32(a.index,1),a.add(4)}function o(e,r,n){var i=new a,o=[],d=new DataView(r,0),_=new t,A=0;0!=(e&l.STATE_MICROS)&&(o[0]=!0,i.timestamp_us=d.getUint32(_.index,1),_.add(4),A=1e6/(i.timestamp_us-T),T=i.timestamp_us),0!=(e&l.STATE_STATUS)&&(o[1]=!0,i.status=d.getUint16(_.index,1),_.add(2)),0!=(e&l.STATE_V0)&&(o[2]=!0,i.V0_raw=d.getUint16(_.index,1),_.add(2)),0!=(e&l.STATE_I0)&&(o[3]=!0,i.I0_raw=d.getUint16(_.index,1),_.add(2)),0!=(e&l.STATE_I1)&&(o[4]=!0,i.I1_raw=d.getUint16(_.index,1),_.add(2)),0!=(e&l.STATE_ACCEL)&&(o[5]=!0,_.parseFloat32Array(d,i.accel)),0!=(e&l.STATE_GYRO)&&(o[6]=!0,_.parseFloat32Array(d,i.gyro)),0!=(e&l.STATE_MAG)&&(o[7]=!0,_.parseFloat32Array(d,i.mag)),0!=(e&l.STATE_TEMPERATURE)&&(o[8]=!0,i.temperature=d.getUint16(_.index,1)/100,_.add(2)),0!=(e&l.STATE_PRESSURE)&&(o[9]=!0,i.pressure=d.getUint32(_.index,1)/256,_.add(4)),0!=(e&l.STATE_RX_PPM)&&(o[10]=!0,_.parseInt16Array(d,i.ppm)),0!=(e&l.STATE_AUX_CHAN_MASK)&&(o[11]=!0,i.AUX_chan_mask=d.getUint8(_.index,1),_.add(1)),0!=(e&l.STATE_COMMANDS)&&(o[12]=!0,_.parseInt16Array(d,i.command)),0!=(e&l.STATE_F_AND_T)&&(o[13]=!0,_.parseFloat32Array(d,i.control)),0!=(e&l.STATE_PID_FZ_MASTER)&&(o[15]=!0,s(d,i.pid_master_Fz,_)),0!=(e&l.STATE_PID_TX_MASTER)&&(o[16]=!0,s(d,i.pid_master_Tx,_)),0!=(e&l.STATE_PID_TY_MASTER)&&(o[17]=!0,s(d,i.pid_master_Ty,_)),0!=(e&l.STATE_PID_TZ_MASTER)&&(o[18]=!0,s(d,i.pid_master_Tz,_)),0!=(e&l.STATE_PID_FZ_SLAVE)&&(o[19]=!0,s(d,i.pid_slave_Fz,_)),0!=(e&l.STATE_PID_TX_SLAVE)&&(o[20]=!0,s(d,i.pid_slave_Tx,_)),0!=(e&l.STATE_PID_TY_SLAVE)&&(o[21]=!0,s(d,i.pid_slave_Ty,_)),0!=(e&l.STATE_PID_TZ_SLAVE)&&(o[22]=!0,s(d,i.pid_slave_Tz,_)),0!=(e&l.STATE_MOTOR_OUT)&&(o[23]=!0,_.parseInt16Array(d,i.MotorOut)),0!=(e&l.STATE_KINE_ANGLE)&&(o[24]=!0,_.parseFloat32Array(d,i.kinematicsAngle)),0!=(e&l.STATE_KINE_RATE)&&(o[25]=!0,_.parseFloat32Array(d,i.kinematicsRate)),0!=(e&l.STATE_KINE_ALTITUDE)&&(o[26]=!0,i.kinematicsAltitude=d.getFloat32(_.index,1),_.add(4)),0!=(e&l.STATE_LOOP_COUNT)&&(o[27]=!0,i.loopCount=d.getUint32(_.index,1),_.add(4)),n(i,o,A)}var d={State:0,Command:1,DebugString:3,HistoryData:4,Response:255},_={COM_REQ_RESPONSE:1,COM_SET_EEPROM_DATA:2,COM_REINIT_EEPROM_DATA:4,COM_REQ_EEPROM_DATA:8,COM_REQ_ENABLE_ITERATION:16,COM_MOTOR_OVERRIDE_SPEED_0:32,COM_MOTOR_OVERRIDE_SPEED_1:64,COM_MOTOR_OVERRIDE_SPEED_2:128,COM_MOTOR_OVERRIDE_SPEED_3:256,COM_MOTOR_OVERRIDE_SPEED_4:512,COM_MOTOR_OVERRIDE_SPEED_5:1024,COM_MOTOR_OVERRIDE_SPEED_6:2048,COM_MOTOR_OVERRIDE_SPEED_7:4096,COM_MOTOR_OVERRIDE_SPEED_ALL:8160,COM_SET_COMMAND_OVERRIDE:8192,COM_SET_STATE_MASK:16384,COM_SET_STATE_DELAY:32768,COM_SET_SD_WRITE_DELAY:65536,COM_SET_LED:1<<17,COM_SET_SERIAL_RC:1<<18,COM_SET_CARD_RECORDING:1<<19,COM_SET_PARTIAL_EEPROM_DATA:1<<20,COM_REINIT_PARTIAL_EEPROM_DATA:1<<21,COM_REQ_PARTIAL_EEPROM_DATA:1<<22,COM_REQ_CARD_RECORDING_STATE:1<<23,COM_SET_PARTIAL_TEMPORARY_CONFIG:1<<24},l={STATE_ALL:4294967295,STATE_NONE:0,STATE_MICROS:1,STATE_STATUS:2,STATE_V0:4,STATE_I0:8,STATE_I1:16,STATE_ACCEL:32,STATE_GYRO:64,STATE_MAG:128,STATE_TEMPERATURE:256,STATE_PRESSURE:512,STATE_RX_PPM:1024,STATE_AUX_CHAN_MASK:2048,STATE_COMMANDS:4096,STATE_F_AND_T:8192,STATE_PID_FZ_MASTER:32768,STATE_PID_TX_MASTER:65536,STATE_PID_TY_MASTER:1<<17,STATE_PID_TZ_MASTER:1<<18,STATE_PID_FZ_SLAVE:1<<19,STATE_PID_TX_SLAVE:1<<20,STATE_PID_TY_SLAVE:1<<21,STATE_PID_TZ_SLAVE:1<<22,STATE_MOTOR_OUT:1<<23,STATE_KINE_ANGLE:1<<24,STATE_KINE_RATE:1<<25,STATE_KINE_ALTITUDE:1<<26,STATE_LOOP_COUNT:1<<27},A={STATUS_BOOT:1,STATUS_MPU_FAIL:2,STATUS_BMP_FAIL:4,STATUS_RX_FAIL:8,STATUS_IDLE:16,STATUS_ENABLING:32,STATUS_CLEAR_MPU_BIAS:64,STATUS_SET_MPU_BIAS:128,STATUS_FAIL_STABILITY:256,STATUS_FAIL_ANGLE:512,STATUS_ENABLED:1024,STATUS_BATTERY_LOW:2048,STATUS_TEMP_WARNING:4096,STATUS_LOG_FULL:8192,STATUS_UNPAIRED:16384,STATUS_OVERRIDE:32768},T=0;return{processBinaryDatastream:r,MessageType:d,CommandFields:_,StatusCodes:A}}angular.module("flybrixCommon").factory("parser",e),e.$inject=["commandLog","serializer"]}(),function(){"use strict";function e(e,t,a,r,n){function i(){}function s(e){m=e,m.onRead=l}function o(i,s,o){void 0===o&&(o=!0);var d=t.defer();i|=n.CommandFields.COM_REQ_RESPONSE;var _,l,A=0;if("object"==typeof s){var T=7+s.length;l=new Uint8Array(T),A^=l[1]=n.MessageType.Command;for(var f=0;f<4;++f)A^=l[f+2]=E(i,f);for(var f=0;f<s.length;f++)A^=l[f+6]=s[f]}else{_=new ArrayBuffer(8),l=new Uint8Array(_),A^=l[1]=n.MessageType.Command;for(var f=0;f<4;++f)A^=l[f+2]=E(i,f);A^=l[6]=s}return l[0]=A,l[l.length-1]=0,S.push({mask:i,response:d}),e(function(){m.send(new Uint8Array(a.encode(l)))},0),o&&r('Sending command <span style="color:blue">'+n.MessageType.Command+"</blue>"),d.promise}function d(){return m.busy()}function _(e){g=e}function l(e){g?g(e,u):I.AppendToBuffer(e,u,A)}function A(e,t){r("COBS decoding failed ("+e+"): "+t)}function T(e){h=e}function f(e){y=e}function c(e,t){for(;S.length>0;){var a=S.shift();{if(a.mask===e){var r=e;if(r&=~n.CommandFields.COM_REQ_RESPONSE,r!==t){a.response.reject("Request was not fully processed");break}a.response.resolve();break}a.response.reject("Missing ACK")}}}function u(e,t,a){n.processBinaryDatastream(e,t,a,h,y,c)}function E(e,t){return e>>8*t&255}var S=[],m=new i,h=function(){r("No state listener defined for serial")},y=function(){r("No command listener defined for serial")},I=new a.Reader(2e3),g=void 0;return i.prototype.busy=function(){return!1},i.prototype.send=function(e){r('No "send" defined for serial backend')},i.prototype.onRead=function(e){r('No "onRead" defined for serial backend')},{busy:d,field:n.CommandFields,send:o,setBackend:s,setStateCallback:T,setCommandCallback:f,setDataHandler:_,Backend:i}}angular.module("flybrixCommon").factory("serial",e),e.$inject=["$timeout","$q","cobs","commandLog","parser"]}(),function(){"use strict";function e(e,t,a){function r(){return C}function n(){t("Requesting current configuration data..."),e.send(e.field.COM_REQ_EEPROM_DATA,[],!1)}function i(){t("Setting factory default configuration data..."),e.send(e.field.COM_REINIT_EEPROM_DATA,[],!1).then(function(){n()},function(e){t("Request for factory reset failed: "+e)})}function s(a){void 0===a&&(a=O),t("Sending new configuration data...");var r=new ArrayBuffer(v),i=new DataView(r,0);m(i,a);var s=new Uint8Array(r);e.send(e.field.COM_SET_EEPROM_DATA,s,!1).then(function(){n()})}function o(t,a,r,i,s){void 0===t&&(t=0),void 0===a&&(a=0),void 0===r&&(r=O);var o=i?e.field.COM_SET_PARTIAL_TEMPORARY_CONFIG:e.field.COM_SET_PARTIAL_EEPROM_DATA,d=new ArrayBuffer(v),_=new DataView(d,0),l=h(_,r,t,a),A=new Uint8Array(d.slice(0,l));e.send(o,A,!1).then(function(){s&&n()})}function d(e,t,a){this.red=e,this.green=t,this.blue=a}function _(e,t,a){e.red=a.getUint8(t.index,1),t.add(1),e.green=a.getUint8(t.index,1),t.add(1),e.blue=a.getUint8(t.index,1),t.add(1)}function l(e,t,a){a.setUint8(t.index,e.red),t.add(1),a.setUint8(t.index,e.green),t.add(1),a.setUint8(t.index,e.blue),t.add(1)}function A(){this.status=0,this.pattern=0,this.colors={right_front:new d(0,0,0),right_back:new d(0,0,0),left_front:new d(0,0,0),left_back:new d(0,0,0)},this.indicator_red=!1,this.indicator_green=!1}function T(e,t,a){e.status=a.getUint16(t.index,1),t.add(2),e.pattern=a.getUint8(t.index,1),t.add(1),_(e.colors.right_front,t,a),_(e.colors.right_back,t,a),_(e.colors.left_front,t,a),_(e.colors.left_back,t,a),e.indicator_red=0!==a.getUint8(t.index,1),t.add(1),e.indicator_green=0!==a.getUint8(t.index,1),t.add(1)}function f(e,t,a){a.setUint16(t.index,e.status,1),t.add(2),a.setUint8(t.index,e.pattern),t.add(1),l(e.colors.right_front,t,a),l(e.colors.right_back,t,a),l(e.colors.left_front,t,a),l(e.colors.left_back,t,a),a.setUint8(t.index,e.indicator_red?1:0),t.add(1),a.setUint8(t.index,e.indicator_green?1:0),t.add(1)}function c(){this.version=[0,0,0],this.id=0,this.pcbOrientation=[0,0,0],this.pcbTranslation=[0,0,0],this.mixTableFz=[0,0,0,0,0,0,0,0],this.mixTableTx=[0,0,0,0,0,0,0,0],this.mixTableTy=[0,0,0,0,0,0,0,0],this.mixTableTz=[0,0,0,0,0,0,0,0],this.magBias=[0,0,0],this.assignedChannel=[0,0,0,0,0,0],this.commandInversion=0,this.channelMidpoint=[0,0,0,0,0,0],this.channelDeadzone=[0,0,0,0,0,0],this.thrustMasterPIDParameters=[0,0,0,0,0,0,0],this.pitchMasterPIDParameters=[0,0,0,0,0,0,0],this.rollMasterPIDParameters=[0,0,0,0,0,0,0],this.yawMasterPIDParameters=[0,0,0,0,0,0,0],this.thrustSlavePIDParameters=[0,0,0,0,0,0,0],this.pitchSlavePIDParameters=[0,0,0,0,0,0,0],this.rollSlavePIDParameters=[0,0,0,0,0,0,0],this.yawSlavePIDParameters=[0,0,0,0,0,0,0],this.thrustGain=0,this.pitchGain=0,this.rollGain=0,this.yawGain=0,this.pidBypass=0,this.stateEstimationParameters=[0,0],this.enableParameters=[0,0],this.ledStates=Array.apply(null,Array(16)).map(function(){return new A}),this.name=""}function u(e,t,a){e.parseFloat32Array(t,a)}function E(e,t){var r=new a;r.parseInt8Array(e,t.version),t.id=e.getUint32(r.index,1),r.add(4),r.parseFloat32Array(e,t.pcbOrientation),r.parseFloat32Array(e,t.pcbTranslation),r.parseInt8Array(e,t.mixTableFz),r.parseInt8Array(e,t.mixTableTx),r.parseInt8Array(e,t.mixTableTy),r.parseInt8Array(e,t.mixTableTz),r.parseFloat32Array(e,t.magBias),r.parseUint8Array(e,t.assignedChannel),t.commandInversion=e.getUint8(r.index),r.add(1),r.parseUint16Array(e,t.channelMidpoint),r.parseUint16Array(e,t.channelDeadzone),u(r,e,t.thrustMasterPIDParameters),u(r,e,t.pitchMasterPIDParameters),u(r,e,t.rollMasterPIDParameters),u(r,e,t.yawMasterPIDParameters),u(r,e,t.thrustSlavePIDParameters),u(r,e,t.pitchSlavePIDParameters),u(r,e,t.rollSlavePIDParameters),u(r,e,t.yawSlavePIDParameters),t.thrustGain=e.getFloat32(r.index,1),r.add(4),t.pitchGain=e.getFloat32(r.index,1),r.add(4),t.rollGain=e.getFloat32(r.index,1),r.add(4),t.yawGain=e.getFloat32(r.index,1),r.add(4),t.pidBypass=e.getUint8(r.index),r.add(1),r.parseFloat32Array(e,t.stateEstimationParameters),r.parseFloat32Array(e,t.enableParameters),t.ledStates.forEach(function(t){T(t,r,e)});var n=new Uint8Array(9);r.parseUint8Array(e,n),t.name=M(n)}function S(e,t){var r=new a,n=e.getUint16(r.index,1);if(r.add(2),n&x.VERSION&&r.parseInt8Array(e,t.version),n&x.ID&&(t.id=e.getUint32(r.index,1),r.add(4)),n&x.PCB&&(r.parseFloat32Array(e,t.pcbOrientation),r.parseFloat32Array(e,t.pcbTranslation)),n&x.MIX_TABLE&&(r.parseInt8Array(e,t.mixTableFz),r.parseInt8Array(e,t.mixTableTx),r.parseInt8Array(e,t.mixTableTy),r.parseInt8Array(e,t.mixTableTz)),n&x.MAG_BIAS&&r.parseFloat32Array(e,t.magBias),n&x.CHANNEL&&(r.parseUint8Array(e,t.assignedChannel),t.commandInversion=e.getUint8(r.index),r.add(1),r.parseUint16Array(e,t.channelMidpoint),r.parseUint16Array(e,t.channelDeadzone)),n&x.PID_PARAMETERS&&(u(r,e,t.thrustMasterPIDParameters),u(r,e,t.pitchMasterPIDParameters),u(r,e,t.rollMasterPIDParameters),u(r,e,t.yawMasterPIDParameters),u(r,e,t.thrustSlavePIDParameters),u(r,e,t.pitchSlavePIDParameters),u(r,e,t.rollSlavePIDParameters),u(r,e,t.yawSlavePIDParameters),t.thrustGain=e.getFloat32(r.index,1),r.add(4),t.pitchGain=e.getFloat32(r.index,1),r.add(4),t.rollGain=e.getFloat32(r.index,1),r.add(4),t.yawGain=e.getFloat32(r.index,1),r.add(4),t.pidBypass=e.getUint8(r.index),r.add(1)),n&x.STATE_PARAMETERS&&(r.parseFloat32Array(e,t.stateEstimationParameters),r.parseFloat32Array(e,t.enableParameters)),n&x.LED_STATES){var i=e.getUint16(r.index,1);r.add(2);for(var s=0;s<16;++s)i&1<<s&&T(t.ledStates[s],r,e)}if(n&x.DEVICE_NAME){var o=new Uint8Array(9);r.parseUint8Array(e,o),t.name=M(o)}}function m(e,t){var r=new a;r.setInt8Array(e,t.version),e.setUint32(r.index,t.id,1),r.add(4),r.setFloat32Array(e,t.pcbOrientation),r.setFloat32Array(e,t.pcbTranslation),r.setInt8Array(e,t.mixTableFz),r.setInt8Array(e,t.mixTableTx),r.setInt8Array(e,t.mixTableTy),r.setInt8Array(e,t.mixTableTz),r.setFloat32Array(e,t.magBias),r.setUint8Array(e,t.assignedChannel),e.setUint8(r.index,t.commandInversion),r.add(1),r.setUint16Array(e,t.channelMidpoint),r.setUint16Array(e,t.channelDeadzone),r.setFloat32Array(e,t.thrustMasterPIDParameters),r.setFloat32Array(e,t.pitchMasterPIDParameters),r.setFloat32Array(e,t.rollMasterPIDParameters),r.setFloat32Array(e,t.yawMasterPIDParameters),r.setFloat32Array(e,t.thrustSlavePIDParameters),r.setFloat32Array(e,t.pitchSlavePIDParameters),r.setFloat32Array(e,t.rollSlavePIDParameters),r.setFloat32Array(e,t.yawSlavePIDParameters),e.setFloat32(r.index,t.thrustGain,1),r.add(4),e.setFloat32(r.index,t.pitchGain,1),r.add(4),e.setFloat32(r.index,t.rollGain,1),r.add(4),e.setFloat32(r.index,t.yawGain,1),r.add(4),e.setUint8(r.index,t.pidBypass),r.add(1),r.setFloat32Array(e,t.stateEstimationParameters),r.setFloat32Array(e,t.enableParameters),t.ledStates.forEach(function(t){f(t,r,e)}),r.setUint8Array(e,D(t.name,9))}function h(e,t,r,n){var i=new a;if(e.setUint16(i.index,r,1),i.add(2),r&x.VERSION&&i.setInt8Array(e,t.version),r&x.ID&&(e.setUint32(i.index,t.id,1),i.add(4)),r&x.PCB&&(i.setFloat32Array(e,t.pcbOrientation),i.setFloat32Array(e,t.pcbTranslation)),r&x.MIX_TABLE&&(i.setInt8Array(e,t.mixTableFz),i.setInt8Array(e,t.mixTableTx),i.setInt8Array(e,t.mixTableTy),i.setInt8Array(e,t.mixTableTz)),r&x.MAG_BIAS&&i.setFloat32Array(e,t.magBias),r&x.CHANNEL&&(i.setUint8Array(e,t.assignedChannel),e.setUint8(i.index,t.commandInversion),i.add(1),i.setUint16Array(e,t.channelMidpoint),i.setUint16Array(e,t.channelDeadzone)),r&x.PID_PARAMETERS&&(i.setFloat32Array(e,t.thrustMasterPIDParameters),i.setFloat32Array(e,t.pitchMasterPIDParameters),i.setFloat32Array(e,t.rollMasterPIDParameters),i.setFloat32Array(e,t.yawMasterPIDParameters),i.setFloat32Array(e,t.thrustSlavePIDParameters),i.setFloat32Array(e,t.pitchSlavePIDParameters),i.setFloat32Array(e,t.rollSlavePIDParameters),i.setFloat32Array(e,t.yawSlavePIDParameters),e.setFloat32(i.index,t.thrustGain,1),i.add(4),e.setFloat32(i.index,t.pitchGain,1),i.add(4),e.setFloat32(i.index,t.rollGain,1),i.add(4),e.setFloat32(i.index,t.yawGain,1),i.add(4),e.setUint8(i.index,t.pidBypass),i.add(1)),r&x.STATE_PARAMETERS&&(i.setFloat32Array(e,t.stateEstimationParameters),i.setFloat32Array(e,t.enableParameters)),r&x.LED_STATES){e.setUint16(i.index,n,1),i.add(2);for(var s=0;s<16;++s)n&1<<s&&f(t.ledStates[s],i,e)}return r&x.DEVICE_NAME&&i.setUint8Array(e,D(t.name,9)),i.index}function y(e){t("Received config!");var a=new DataView(e,0);O=new c,E(a,O),g()}function I(e){t("Received partial config!");var a=new DataView(e,0);O=angular.copy(O),S(a,O),g()}function g(){C[0]!==O.version[0]||C[1]!==O.version[1]?(t('<span style="color: red">WARNING: Configuration MAJOR or MINOR version mismatch!</span>'),t("eeprom version: <strong>"+O.version[0]+"."+O.version[1]+"."+O.version[2]+"</strong> - app expected version: <strong>"+C[0]+"."+C[1]+"."+C[2]+"</strong>")):(t('Recieved configuration version: <span style="color: green">'+O.version[0]+"."+O.version[1]+"."+O.version[2]+"</span>"),b())}function p(e){b=e}function P(e){U=e}function R(){return O}function D(e,t){var a=new Uint8Array(t);return e.split("").forEach(function(e,t){a[t]=e.charCodeAt(0)}),a[t-1]=0,a}function M(e){for(var t="",a=0;a<e.length&&a<8;++a){if(0===e[a])return t;t+=String.fromCharCode(e[a])}return t}var O,v=652,C=[1,5,0],b=function(){t("No callback defined for receiving configurations!")},U=function(){t("No callback defined for receiving logging state! Callback arguments: (isLogging, isLocked, delay)")},x={VERSION:1,ID:2,PCB:4,MIX_TABLE:8,MAG_BIAS:16,CHANNEL:32,PID_PARAMETERS:64,STATE_PARAMETERS:128,LED_STATES:256,DEVICE_NAME:512};return e.setCommandCallback(function(a,r){if(a&e.field.COM_SET_EEPROM_DATA&&y(r),a&e.field.COM_SET_PARTIAL_EEPROM_DATA&&I(r),a&(e.field.COM_SET_CARD_RECORDING|e.field.COM_SET_SD_WRITE_DELAY)){var n=new Uint8Array(r);if(n.length>=3){var i=n[0]|n[1]<<8,s=n[2];U(0!==(1&s),0!==(2&s),i)}else t("Bad data given for logging info")}}),O=new c,{request:n,reinit:i,send:s,sendPartial:o,getConfig:R,setConfigCallback:p,setLoggingCallback:P,getDesiredVersion:r,field:x}}angular.module("flybrixCommon").factory("deviceConfig",e),e.$inject=["serial","commandLog","serializer"]}(),function(){"use strict";function e(e){function t(e,t,a,n,d,_,l){d>0&&d<6&&(o.pattern=d),[e,t,a,n].forEach(function(e,t){if(e){var a=s[i[t]];a.red=e.red,a.green=e.green,a.blue=e.blue}}),void 0!==_&&(o.indicator_red=_),void 0!==l&&(o.indicator_green=l),r()}function a(e,a,r){var i={red:e||0,green:a||0,blue:r||0};t(i,i,i,i,n.SOLID)}function r(){e.sendPartial(e.field.LED_STATES,1,d,!0)}var n={NO_OVERRIDE:0,FLASH:1,BEACON:2,BREATHE:3,ALTERNATE:4,SOLID:5},i=["right_front","right_back","left_front","left_back"],s={};i.forEach(function(e){s[e]={red:0,green:0,blue:0}});var o={status:65535,pattern:n.SOLID,colors:s,indicator_red:!1,indicator_green:!1},d={ledStates:[o]};return{set:t,setSimple:a,patterns:n}}angular.module("flybrixCommon").factory("led",e),e.$inject=["deviceConfig"]}(),function(){"use strict";function e(e,t){function a(){if(R||!e.busy()){R=!1;var a=new t,r=new ArrayBuffer(10),n=new DataView(r,0);n.setUint8(a.index,1),a.add(1);var i=-.8,s=E(4095*(h-i)/(1-i),0,4095),o=E(4095*-S(y,.1)/2,-2047,2047),d=E(4095*S(I,.1)/2,-2047,2047),_=E(4095*-S(g,.1)/2,-2047,2047),l=[s,o,d,_];a.setInt16Array(n,l);var A=(1<<p)+(1<<P+3);return n.setUint8(a.index,A),e.send(e.field.COM_SET_SERIAL_RC,new Uint8Array(r),!1)}}function r(e){h=e}function n(e){y=e}function i(e){I=e}function s(e){g=e}function o(e){p=e}function d(e){P=e}function _(){return h}function l(){return y}function A(){return I}function T(){return g}function f(){return p}function c(){return P}function u(){R=!0}function E(e,t,a){return Math.max(t,Math.min(e,a))}function S(e,t){return e>t?e-t:e<-t?e+t:0}var m={LOW:0,MID:1,HIGH:2},h=-1,y=0,I=0,g=0,p=m.HIGH,P=m.HIGH,R=!0;return{setThrottle:r,setPitch:n,setRoll:i,setYaw:s,setAux1:o,setAux2:d,getThrottle:_,getPitch:l,getRoll:A,getYaw:T,getAux1:f,getAux2:c,AUX:m,send:a,forceNextSend:u}}angular.module("flybrixCommon").factory("rcData",e),e.$inject=["serial","serializer"]}();